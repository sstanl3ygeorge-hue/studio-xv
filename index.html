<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Studio XV</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      /* DARK MODE (DEFAULT) */
      --bg-main: #000000;
      --bg-section: #0d0d0d;
      --bg-card: #111111;
      --bg-soft: #181818;

      --text-main: #ffffff;
      --text-muted: #b5b5b5;

      --accent: #f97316; /* orange */
      --border-soft: rgba(255,255,255,0.12);
    }

    @media (prefers-color-scheme: light) {
      :root {
        /* LIGHT MODE OVERRIDES */
        --bg-main: #ffffff;
        --bg-section: #f5f5f5;
        --bg-card: #ffffff;
        --bg-soft: #eeeeee;

        --text-main: #0b0b0b;
        --text-muted: #555555;

        --border-soft: rgba(0,0,0,0.12);
      }
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-main);
      color: var(--text-main);
      overflow-x: hidden;
    }

    html {
      scroll-behavior: smooth;
    }

    .mobile-link {
      font-weight: 600;
      letter-spacing: 0.05em;
      padding: 0.75rem 0;
      transition: color 0.25s ease;
    }

    section {
      scroll-margin-top: 96px;
    }

    .step {
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .step.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    audio {
      opacity: 0.85;
      transition: opacity 0.2s ease, box-shadow 0.2s ease;
    }

    audio:hover {
      opacity: 1;
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    .badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border-soft);
      letter-spacing: 0.04em;
    }

    .waveform {
      height: 80px;
      margin-bottom: 0.75rem;
    }

    .controls {
      display: flex;
      gap: 1rem;
      font-size: 0.85rem;
    }

    .play-btn,
    .toggle-btn {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
    }

    .play-btn:hover,
    .toggle-btn:hover {
      text-decoration: underline;
    }

    .ab-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0;
    }

    .ab-btn {
      background: none;
      border: none;
      padding: 0;
      color: #f97316;
      cursor: pointer;
      font-weight: 500;
      text-decoration: none;
      font-size: inherit;
    }

    .ab-btn:hover {
      text-decoration: underline;
    }

    .ab-btn.active {
      font-weight: 600;
    }

    .separator {
      margin: 0 6px;
      color: #888;
      pointer-events: none;
    }

    .waveform-player.playing {
      background: rgba(249,115,22,0.08);
      border: 1px solid rgba(249,115,22,0.3);
      box-shadow: 0 0 20px rgba(249,115,22,0.15);
      transition: all 0.3s ease;
    }

    /* Booking form micro-interactions */
    input:not([type="file"]),
    select,
    textarea {
      transition: all 0.2s ease;
    }

    input:focus,
    select:focus,
    textarea:focus {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* Checkbox animations */
    input[type="checkbox"] {
      transition: transform 0.2s ease;
    }

    input[type="checkbox"]:checked {
      transform: scale(1.1);
    }

    label:has(input[type="checkbox"]:checked) {
      animation: checkboxPulse 0.3s ease;
    }

    @keyframes checkboxPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* Price summary transitions */
    #deposit-display,
    #summary-addons {
      transition: all 0.3s ease;
    }

    #deposit-display.updating {
      animation: priceUpdate 0.4s ease;
    }

    @keyframes priceUpdate {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Light mode form input styling */
    @media (prefers-color-scheme: light) {
      input:not([type="file"]):not([type="checkbox"]),
      select,
      textarea {
        background: white !important;
        border-color: rgba(0,0,0,0.15) !important;
        color: black !important;
      }

      input:not([type="file"]):not([type="checkbox"]):focus,
      select:focus,
      textarea:focus {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }
    }

    /* Mobile spacing improvements */
    @media (max-width: 768px) {
      #booking .space-y-8 > * + * {
        margin-top: 2rem;
      }

      #booking input:not([type="file"]):not([type="checkbox"]),
      #booking select,
      #booking textarea,
      #booking button[type="submit"] {
        min-height: 48px;
        font-size: 16px;
      }

      #booking input[type="checkbox"] {
        width: 24px;
        height: 24px;
        min-width: 24px;
        min-height: 24px;
      }

      #booking label:has(input[type="checkbox"]) {
        padding: 12px 0;
        gap: 16px;
      }

      #booking .rounded-2xl {
        padding: 24px;
      }

      #booking textarea {
        min-height: 120px;
      }
    }

    /* Service Modal */
    #service-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    #service-modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    #service-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    #service-modal-content {
      position: relative;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 16px;
      padding: 40px;
      animation: modalScale 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes modalScale {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    #service-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
    }

    #service-modal-close:hover {
      transform: scale(1.1);
      opacity: 1;
    }

    /* Hide old service detail sections - using modal instead */
    section#recording,
    section#mixing,
    section#mastering,
    section#production,
    section#lessons {
      display: none !important;
    }
  </style>
</head>

<body>

<!-- Service Modal -->
<div id="service-modal">
  <div id="service-modal-overlay"></div>
  <div id="service-modal-content" style="background: var(--bg-soft);">
    <div id="service-modal-close" title="Close">‚úï</div>
    <div id="service-modal-body"></div>
  </div>
</div>

<!-- NAV -->
<nav class="fixed top-0 left-0 right-0 z-50 backdrop-blur"
     style="background: var(--bg-main); color: var(--text-main);">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <a href="#home" id="logo-nav" class="text-xl font-bold">Studio XV</a>

    <!-- Desktop -->
    <div class="hidden md:flex space-x-8">
      <a href="#home" class="transition hover:text-[var(--accent)]">Home</a>
      <a href="#services" class="transition hover:text-[var(--accent)]">Services</a>
      <a href="#portfolio" class="transition hover:text-[var(--accent)]">Portfolio</a>
      <a href="#booking" class="transition hover:text-[var(--accent)]">Booking</a>
      <a href="#about" class="transition hover:text-[var(--accent)]">About</a>
    </div>

    <!-- Mobile toggle -->
    <button id="menu-toggle" class="md:hidden text-3xl">‚ò∞</button>
  </div>
</nav>

<div id="mobile-menu"
  class="fixed top-0 right-0 h-full w-4/5 max-w-sm
         transform translate-x-full transition-transform duration-300 z-[9999] shadow-2xl"
  style="background: var(--bg-main); color: var(--text-main);">

  <div class="flex justify-end p-6">
    <button id="menu-close" class="text-3xl">‚úï</button>
  </div>

  <nav class="flex flex-col gap-8 text-center mt-10 text-xl">
    <a href="#home" class="mobile-link hover:text-[var(--accent)]">Home</a>
    <a href="#services" class="mobile-link hover:text-[var(--accent)]">Services</a>
    <a href="#portfolio" class="mobile-link hover:text-[var(--accent)]">Portfolio</a>
    <a href="#booking" class="mobile-link hover:text-[var(--accent)]">Booking</a>
    <a href="#about" class="mobile-link hover:text-[var(--accent)]">About</a>
  </nav>
</div>

<!-- HERO -->
<section id="home" class="min-h-screen pt-24 flex items-center justify-center px-6"
         style="background: var(--bg-main);">
  <div class="text-center space-y-12 w-full max-w-4xl mx-auto">
    <a href="#services" id="logo-hero" class="block">
      <div class="leading-none">
        <div class="tracking-[0.3em] opacity-80">STUDIO</div>
        <div class="text-7xl font-extrabold">XV</div>
      </div>
    </a>

    <div class="space-y-6 max-w-2xl mx-auto">
      <h1 class="text-3xl md:text-4xl font-bold leading-tight">Professional recording, mixing, and production</h1>
      <p class="text-lg md:text-xl opacity-80 leading-relaxed">A dedicated studio space in London for artists, producers, and songwriters. Whether you're tracking, mixing, or need production support ‚Äî everything's handled with care and precision.</p>
    </div>

    <a href="#services"
      class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
      style="background: var(--accent);">
      Explore Services
    </a>

    <!-- WHAT ARE YOU WORKING ON -->
    <div class="pt-8">
      <p class="text-sm uppercase tracking-wider opacity-50 mb-8">What are you working on?</p>
      
      <div class="flex flex-wrap justify-center gap-x-8 gap-y-4 text-base">
        <a href="javascript:void(0)" onclick="openServiceModal('recording')"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Recording
        </a>
        <a href="javascript:void(0)" onclick="openServiceModal('mixing')"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Mixing
        </a>
        <a href="javascript:void(0)" onclick="openServiceModal('mastering')"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Mastering
        </a>
        <a href="javascript:void(0)" onclick="openServiceModal('production')"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Beats & Production
        </a>
        <a href="javascript:void(0)" onclick="openServiceModal('lessons')"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Production Lessons
        </a>
      </div>
    </div>
  </div>
</section>

<!-- NEW: WHO THIS IS FOR (easily removable) -->
<section class="py-16 px-6" style="background: var(--bg-main);">
  <div class="max-w-4xl mx-auto">
    <div class="text-center space-y-8">
      <h2 class="text-2xl md:text-3xl font-semibold opacity-90">This studio is for anyone building something they care about</h2>
      <div class="grid md:grid-cols-3 gap-8 text-left">
        <div class="space-y-3">
          <div class="text-5xl opacity-20">üé§</div>
          <h3 class="font-semibold text-lg">Recording Artists</h3>
          <p class="text-sm opacity-70 leading-relaxed">Vocals, instruments, full band sessions. Comfortable environment with quality gear and an engineer who listens.</p>
        </div>
        <div class="space-y-3">
          <div class="text-5xl opacity-20">üéöÔ∏è</div>
          <h3 class="font-semibold text-lg">Producers & Beatmakers</h3>
          <p class="text-sm opacity-70 leading-relaxed">Mix support, mastering, or production lessons. Get your tracks sounding right without the guesswork.</p>
        </div>
        <div class="space-y-3">
          <div class="text-5xl opacity-20">üìÄ</div>
          <h3 class="font-semibold text-lg">Independent Releases</h3>
          <p class="text-sm opacity-70 leading-relaxed">Singles, EPs, albums. Consistent quality across your project with flexible packages that adapt to your workflow.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- NEW: PHILOSOPHY (easily removable) -->
<section class="py-16 px-6" style="background: var(--bg-section);">
  <div class="max-w-3xl mx-auto text-center space-y-6">
    <h2 class="text-2xl md:text-3xl font-semibold opacity-90">No pressure. No upselling. Just focused work.</h2>
    <p class="text-base md:text-lg opacity-70 leading-relaxed max-w-2xl mx-auto">
      This isn't a factory. Sessions are booked with intention, and the aim is simple: help you get the sound you're after. Whether you're here for an hour or working on a full project, you'll have the space and support to do it properly.
    </p>
    <p class="text-sm opacity-60 max-w-xl mx-auto">
      Transparent pricing. Clear communication. Equipment that works. That's the standard.
    </p>
  </div>
</section>

<!-- SERVICES -->
<section id="services" class="pt-16 pb-24 px-6" style="background: var(--bg-section);">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-4">
      Services
    </h2>
    <p class="text-center mb-16">
      <a href="javascript:void(0)" onclick="openHowItWorksModal()" 
         class="text-sm opacity-70 hover:text-orange-500 hover:opacity-100 transition underline-offset-4 hover:underline cursor-pointer">
        How sessions work ‚Üí
      </a>
    </p>

    <div
      id="services-grid"
      class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"
    ></div>
  </div>
</section>

<!-- RECORDING SERVICE DETAIL -->
<section id="recording" class="py-24 px-6" style="background: var(--bg-main);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-6">Recording</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-12">
      Professional studio recording sessions with high-end equipment and an experienced engineer. Whether you're tracking vocals, instruments, or full band sessions, we'll capture your sound with clarity and precision.
    </p>

    <div class="mb-12">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        <li>‚Ä¢ Professional recording environment</li>
        <li>‚Ä¢ High-end microphones and preamps</li>
        <li>‚Ä¢ Experienced recording engineer</li>
        <li>‚Ä¢ Session files provided</li>
      </ul>
    </div>

    <div class="mb-12 p-6 rounded-xl" style="background: var(--bg-soft); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        <li class="flex justify-between"><span>Hourly Session</span> <span>¬£30/hr</span></li>
        <li class="flex justify-between"><span>Half-Day (4hrs)</span> <span>¬£140</span></li>
        <li class="flex justify-between"><span>Full-Day (8hrs)</span> <span>¬£260</span></li>
      </ul>
    </div>

    <a href="/?service=recording&source=service-page#booking"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book Recording Session
    </a>
  </div>
</section>

<!-- MIXING SERVICE DETAIL -->
<section id="mixing" class="py-24 px-6" style="background: var(--bg-section);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-6">Mixing</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-12">
      Transform your recorded tracks into a polished, professional mix. We'll balance levels, add effects, and ensure every element sits perfectly in the stereo field. Mixing services include unlimited revisions until you're completely satisfied.
    </p>

    <div class="mb-12">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        <li>‚Ä¢ Professional mixing with industry-standard plugins</li>
        <li>‚Ä¢ Stereo balance and EQ optimization</li>
        <li>‚Ä¢ Compression and dynamic control</li>
        <li>‚Ä¢ Unlimited revisions</li>
        <li>‚Ä¢ High-quality WAV file delivery</li>
      </ul>
    </div>

    <div class="mb-12 p-6 rounded-xl" style="background: var(--bg-soft); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        <li class="flex justify-between"><span>Per Track</span> <span>¬£50</span></li>
        <li class="flex justify-between"><span>Mix + Master</span> <span>¬£75</span></li>
        <li class="flex justify-between"><span>EP (4‚Äì6 tracks)</span> <span>¬£280</span></li>
      </ul>
    </div>

    <a href="/?service=mixing&source=service-page#booking"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book Mixing Service
    </a>
  </div>
</section>

<!-- MASTERING SERVICE DETAIL -->
<section id="mastering" class="py-24 px-6" style="background: var(--bg-main);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-6">Mastering</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-12">
      Final polish for your mixes. Professional mastering ensures your tracks translate well across all playback systems, from earbuds to club sound systems. We'll optimize loudness, add final EQ touches, and prepare your music for distribution.
    </p>

    <div class="mb-12">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        <li>‚Ä¢ Professional mastering chain</li>
        <li>‚Ä¢ Loudness optimization for streaming platforms</li>
        <li>‚Ä¢ Final EQ and compression</li>
        <li>‚Ä¢ Stereo enhancement</li>
        <li>‚Ä¢ Distribution-ready files (WAV & MP3)</li>
      </ul>
    </div>

    <div class="mb-12 p-6 rounded-xl" style="background: var(--bg-soft); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        <li class="flex justify-between"><span>Single</span> <span>¬£35</span></li>
        <li class="flex justify-between"><span>EP (4‚Äì6 tracks)</span> <span>¬£120</span></li>
        <li class="flex justify-between"><span>Album (10+ tracks)</span> <span>¬£250</span></li>
      </ul>
    </div>

    <a href="/?service=mastering&source=service-page#booking"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book Mastering Service
    </a>
  </div>
</section>

<!-- PRODUCTION SERVICE DETAIL -->
<section id="production" class="py-24 px-6" style="background: var(--bg-section);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-6">Production</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-12">
      Custom beat production and exclusive licensing. Browse our catalogue of ready-made beats or commission a fully custom production tailored to your sound. All beats include stems and full commercial rights.
    </p>

    <div class="mb-12">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        <li>‚Ä¢ High-quality beat production</li>
        <li>‚Ä¢ Stems included (individual tracks)</li>
        <li>‚Ä¢ Commercial rights and licensing</li>
        <li>‚Ä¢ Custom revisions available</li>
        <li>‚Ä¢ WAV file delivery</li>
      </ul>
    </div>

    <div class="mb-12 p-6 rounded-xl" style="background: var(--bg-soft); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        <li class="flex justify-between"><span>Beat Lease</span> <span>¬£40</span></li>
        <li class="flex justify-between"><span>Exclusive Beat</span> <span>¬£150</span></li>
        <li class="flex justify-between"><span>Custom Production</span> <span>POA</span></li>
      </ul>
    </div>

    <a href="/?service=production&source=service-page#booking"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book Production Service
    </a>
  </div>
</section>

<!-- LESSONS SERVICE DETAIL -->
<section id="lessons" class="py-24 px-6" style="background: var(--bg-main);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold mb-6">Production Lessons</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-12">
      One-on-one music production lessons tailored to your skill level and goals. Learn DAW fundamentals, mixing techniques, sound design, arrangement, or work on your own projects with expert guidance.
    </p>

    <div class="mb-12">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        <li>‚Ä¢ Personalized 1-on-1 instruction</li>
        <li>‚Ä¢ Flexible curriculum based on your goals</li>
        <li>‚Ä¢ Hands-on learning with professional tools</li>
        <li>‚Ä¢ Session recordings and notes provided</li>
        <li>‚Ä¢ Project feedback and guidance</li>
      </ul>
    </div>

    <div class="mb-12 p-6 rounded-xl" style="background: var(--bg-soft); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        <li class="flex justify-between"><span>Single Session (1hr)</span> <span>¬£40</span></li>
        <li class="flex justify-between"><span>5-Session Package</span> <span>¬£180</span></li>
        <li class="flex justify-between"><span>10-Session Package</span> <span>¬£340</span></li>
      </ul>
    </div>

    <a href="/?service=lessons&source=service-page#booking"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book Production Lessons
    </a>
  </div>
</section>

<section id="portfolio" class="py-24 px-6"
         style="background: var(--bg-section);">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">Portfolio</h2>

    <div class="grid md:grid-cols-2 gap-8" id="portfolio-grid"></div>

    <div class="text-center mt-16">
      <p class="text-lg opacity-80 mb-6">
        Want your track to sound like this?
      </p>
      <a
        href="#booking"
        class="inline-block px-8 py-4 rounded-lg font-semibold text-white"
        style="background: var(--accent);"
      >
        Book a Session
      </a>
    </div>
  </div>
</section>

<section id="booking" class="py-28 px-6" style="background: var(--bg-section);">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">
      Book Your Session
    </h2>

    <div class="rounded-2xl p-10 shadow-xl" style="background: var(--bg-soft);">

      <p class="text-xs uppercase tracking-wider opacity-50 mb-4 text-center font-semibold">
        Step 1 of 3 ‚Äî Session details
      </p>

      <p id="booking-status" class="text-sm opacity-0 mb-6 text-center transition-opacity duration-300">
        You're booking a session
      </p>

      <form
        name="booking"
        method="POST"
        data-netlify="true"
        netlify-honeypot="bot-field"
        enctype="multipart/form-data"
        class="space-y-8"
      >
        <input type="hidden" name="form-name" value="booking" />
        <input type="hidden" name="subject" value="Studio XV ‚Äî Booking Request Received (Payment Pending)" />
        <input type="hidden" name="reply-to" value="email" />
        <input type="hidden" name="booking-status" value="‚ö†Ô∏è PAYMENT PENDING - Awaiting Stripe checkout completion" />

        <!-- Booking Metadata (for backend automation) -->
        <input type="hidden" id="metadata-service-type" name="metadata-service-type" value="" />
        <input type="hidden" id="metadata-package-hours" name="metadata-package-hours" value="" />
        <input type="hidden" id="metadata-deposit-amount" name="metadata-deposit-amount" value="" />
        <input type="hidden" id="metadata-has-files" name="metadata-has-files" value="false" />
        <input type="hidden" id="metadata-has-cloud-link" name="metadata-has-cloud-link" value="false" />

        <!-- Honeypot -->
        <p class="hidden">
          <label>
            Don't fill this out:
            <input name="bot-field" />
          </label>
        </p>

        <!-- Service -->
        <div>
          <label class="block mb-2 font-semibold">Service</label>
          <select
            name="service"
            id="service-select"
            required
            class="w-full px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          >
            <option value="">Select a service‚Ä¶</option>
          </select>
        </div>

        <!-- Hours (shown for hourly services only) -->
        <div id="hours-wrapper" class="hidden space-y-2">
          <label class="text-sm opacity-70" id="hours-label">Number of hours</label>
          <input
            type="number"
            id="hours-input"
            min="1"
            value="2"
            class="w-full px-4 py-3 rounded-lg border focus:outline-none"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
          <p class="text-xs opacity-60" id="hours-hint">Most artists book 2‚Äì4 hours.</p>
        </div>

        <!-- Package selector -->
        <section id="package-wrapper" class="hidden">
          <label class="text-sm opacity-70 mb-2 block">Package</label>
          <select
            id="package-select"
            class="w-full px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          >
            <option value="">Choose a package‚Ä¶</option>
          </select>
        </section>

        <!-- Add-Ons -->
        <div id="addons-wrapper" class="space-y-3">
          <label class="block font-semibold">Add-Ons (optional)</label>
          
          <label class="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              class="addon-checkbox w-5 h-5"
              value="vocalTuning"
            />
            <span>Vocal Tuning ‚Äî ¬£25</span>
          </label>

          <label class="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              class="addon-checkbox w-5 h-5"
              value="stems"
            />
            <span>Stems Export ‚Äî ¬£20</span>
          </label>

          <label class="flex items-center gap-3 cursor-pointer">
            <input
              type="checkbox"
              class="addon-checkbox w-5 h-5"
              value="rush"
            />
            <span>Rush Delivery ‚Äî +50%</span>
          </label>
        </div>

        <!-- Your details -->
        <div class="grid md:grid-cols-2 gap-6">
          <input
            type="text"
            name="name"
            placeholder="Full Name"
            required
            class="px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
          <input
            type="email"
            name="email"
            placeholder="Email"
            required
            class="px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
        </div>

        <input
          type="tel"
          name="phone"
          placeholder="Phone number"
          class="w-full px-4 py-3 rounded-lg border"
          style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
        />

        <input
          type="date"
          name="preferred-date"
          class="w-full px-4 py-3 rounded-lg border"
          style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main); color-scheme: dark;"
        />

        <!-- File upload -->
        <div>
          <label class="block mb-2 font-semibold">
            Upload audio / stems (optional)
          </label>
          <input
            type="file"
            name="audio"
            accept=".mp3,.wav,.zip,.aiff"
            multiple
            class="w-full text-sm
              file:bg-orange-600 file:text-white
              file:border-none file:px-4 file:py-2
              file:rounded-lg file:cursor-pointer
              hover:file:bg-orange-500"
          />
          <p class="text-xs opacity-60 mt-2">Upload one or more files. For stems, select all files at once. WAV or AIFF preferred. For large sessions, a cloud link may be faster.</p>
        </div>

        <!-- Cloud Storage Link -->
        <div>
          <label class="block mb-2 font-semibold">
            Or provide a cloud storage link (optional)
          </label>
          <input
            type="url"
            name="cloud-link"
            placeholder="Dropbox, Google Drive, WeTransfer, etc."
            class="w-full px-4 py-3 rounded-lg border focus:outline-none"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
          <p id="upload-hint" class="text-xs opacity-60 mt-2" style="display: none;"></p>
        </div>

        <!-- Notes -->
        <textarea
          name="details"
          rows="4"
          placeholder="Tell us about your project‚Ä¶"
          class="w-full px-4 py-3 rounded-lg border"
          style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
        ></textarea>

        <!-- Price Summary -->
        <div class="rounded-xl p-5 border space-y-2" style="background: var(--bg-card); border-color: var(--border-soft);">
          <div class="flex justify-between">
            <span>Total session price</span>
            <span class="font-semibold">¬£<span id="total-display">0</span></span>
          </div>

          <div id="summary-addons" class="space-y-1"></div>

          <div class="flex justify-between text-orange-500 font-semibold">
            <span>Deposit due today (50%)</span>
            <span>¬£<span id="deposit-display">0</span></span>
          </div>

          <p class="text-xs opacity-60 mt-2">
            The remaining balance is payable on the session day.
          </p>
          <p class="text-xs opacity-60">
            Custom Production projects are quoted individually based on scope and timeline.
          </p>
        </div>

        <!-- Trust Message -->
        <p class="text-center text-sm opacity-70">
          üîí Secure booking ¬∑ No payment taken until your session is confirmed
        </p>

        <!-- Submit -->
        <button
          type="submit"
          id="booking-submit"
          class="w-full h-14 rounded-lg bg-orange-600 font-bold text-lg hover:bg-orange-500 transition"
        >
          Submit Booking Request
        </button>

        <p class="text-center text-sm opacity-60">
          You'll receive a confirmation email once your request is reviewed.
        </p>

        <div data-netlify-recaptcha="true"></div>
      </form>

    </div>
  </div>
</section>

<section id="about" class="py-24 px-6"
         style="background: var(--bg-section);">
  <div class="max-w-3xl mx-auto text-center">
    <h2 class="text-4xl md:text-5xl font-bold mb-10">About Studio XV</h2>

    <p class="text-lg leading-relaxed"
       style="color: var(--text-muted);">
      Studio XV is a professional recording and production space built for
      artists who value sound quality, creative freedom, and a stress-free
      environment. With over 15 years of experience, we specialise in recording,
      mixing, mastering, and production across multiple genres.
    </p>
  </div>
</section>

<footer class="py-12 text-center opacity-70">
  ¬© 2026 Studio XV. All rights reserved.
</footer>

<script>
  const toggle = document.getElementById('menu-toggle');
  const closeBtn = document.getElementById('menu-close');
  const menu = document.getElementById('mobile-menu');

  function openMenu() {
    menu.classList.remove('translate-x-full');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    menu.classList.add('translate-x-full');
    document.body.style.overflow = '';
  }

  toggle.addEventListener('click', openMenu);
  closeBtn.addEventListener('click', closeMenu);

  menu.querySelectorAll('a').forEach(link =>
    link.addEventListener('click', closeMenu)
  );
</script>

<script>
const PRICING = {
  recording: {
    label: "Recording",
    type: "hourly",
    rate: 30,
    minHours: 1,
    items: [
      { label: "Hourly Session", price: "¬£30/hr" },
      { label: "Half-Day (4hrs)", price: "¬£140" },
      { label: "Full-Day (8hrs)", price: "¬£260" }
    ],
    packages: [
      { label: "Per Track", price: 50 },
      { label: "Mix + Master", price: 75 },
      { label: "EP (4‚Äì6 tracks)", price: 280 }
    ]
  },

  mixing: {
    label: "Mixing",
    type: "packages",
    items: [
      { label: "Per Track", price: "¬£50" },
      { label: "Mix + Master", price: "¬£75" },
      { label: "EP (4‚Äì6 tracks)", price: "¬£280" }
    ],
    packages: [
      { label: "Per Track", price: 50 },
      { label: "Mix + Master", price: 75 },
      { label: "EP (4‚Äì6 tracks)", price: 280 }
    ]
  },

  mastering: {
    label: "Mastering",
    type: "packages",
    items: [
      { label: "Single", price: "¬£35" },
      { label: "EP (4‚Äì6 tracks)", price: "¬£120" },
      { label: "Album (10+ tracks)", price: "¬£250" }
    ],
    packages: [
      { label: "Single", price: 35 },
      { label: "EP (4‚Äì6 tracks)", price: 120 },
      { label: "Album (10+ tracks)", price: 250 }
    ]
  },

  production: {
    label: "Production",
    type: "packages",
    items: [
      { label: "Beat Lease", price: "¬£40" },
      { label: "Exclusive Beat", price: "¬£150" },
      { label: "Custom Production", price: "POA" }
    ],
    packages: [
      { label: "Beat Lease", price: 40 },
      { label: "Exclusive Beat", price: 150 },
      { label: "Custom Production", poa: true }
    ]
  },

  lessons: {
    label: "Lessons",
    type: "hourly",
    rate: 40,
    minHours: 1,
    maxHours: 4,
    coachingCopy: "Guided sessions focused on skill-building and workflow.",
    items: [
      { label: "Hourly Session", price: "¬£40/hr" },
      { label: "2-Hour Session", price: "¬£80" },
      { label: "4-Hour Session", price: "¬£160" }
    ],
    packages: [
      { label: "Per Track", price: 50 },
      { label: "Mix + Master", price: 75 },
      { label: "EP (4‚Äì6 tracks)", price: 280 }
    ]
  },

  addons: {
    label: "Add-Ons",
    type: "addons",
    items: [
      { label: "Vocal Tuning", price: "¬£25" },
      { label: "Stems Export", price: "¬£20" },
      { label: "Rush Delivery", price: "+50%" }
    ]
  }
};

const ADDONS = {
  vocalTuning: { label: "Vocal Tuning", price: 25 },
  stems: { label: "Stems Export", price: 20 },
  rush: { label: "Rush Delivery", multiplier: 1.5 }
};
</script>

<script>
const PORTFOLIO = {
  mixes: [
    {
      id: "city-lights",
      title: "City Lights",
      genre: "Afro House",
      credit: "Produced, Mixed & Mastered",
      badges: ["Produced", "Mixed", "Mastered"],
      before: "https://studioxv-media.b-cdn.net/mixes/city-lights-before.mp3",
      after: "https://studioxv-media.b-cdn.net/mixes/city-lights-after.mp3"
    },
    {
      id: "midnight-drive",
      title: "Midnight Drive",
      genre: "Trap",
      credit: "Mastered",
      badges: ["Mastered"],
      before: "https://studioxv-media.b-cdn.net/mixes/midnight-drive-before.mp3",
      after: "https://studioxv-media.b-cdn.net/mixes/midnight-drive-after.mp3"
    },
    {
      id: "elevation",
      title: "Elevation",
      genre: "Afrobeats",
      credit: "Mixed & Mastered",
      badges: ["Mixed", "Mastered"],
      before: "https://studioxv-media.b-cdn.net/mixes/Elevation-before.mp3",
      after: "https://studioxv-media.b-cdn.net/mixes/Elevation-after.mp3"
    }
  ],

  beats: [
    {
      title: "Neon Dreams",
      genre: "Trap / Melodic",
      badges: ["D‚ôØ minor", "140 BPM"],
      subtitle: "Available for lease or exclusive",
      src: "https://studioxv-media.b-cdn.net/beats/neon-dreams.mp3"
    },
    {
      title: "Street Gospel",
      genre: "Afro pop",
      badges: ["D major", "113 BPM"],
      subtitle: "Available for lease or exclusive",
      src: "https://studioxv-media.b-cdn.net/beats/street-gospel.mp3"
    },
    {
      title: "Summer Breeze",
      genre: "Afrobeats",
      badges: ["C minor", "100 BPM"],
      subtitle: "Available for lease or exclusive",
      src: "https://studioxv-media.b-cdn.net/beats/summer-breeze.mp3"
    }
  ]
};
</script>

<script>
function renderPortfolio() {
  const grid = document.getElementById("portfolio-grid");
  if (!grid) return;

  // MIXES CARD
  const mixesCard = document.createElement("div");
  mixesCard.className =
    "rounded-2xl p-8 bg-[var(--bg-card)] border border-white/10";

  mixesCard.innerHTML = `
    <h3 class="text-2xl font-bold mb-2">Recent Mixes</h3>
    <p class="text-sm opacity-70 mb-6">Selected projects mixed and mastered at Studio XV.</p>
    <div id="recent-mixes" class="space-y-6"></div>
    <p class="text-sm opacity-70 mt-6">
      Like this sound?
      <a href="/?service=mixing&source=portfolio#booking" class="text-orange-500 font-semibold">Book a mixing session ‚Üí</a>
    </p>
  `;

  // BEATS CARD
  const beatsCard = document.createElement("div");
  beatsCard.className =
    "rounded-2xl p-8 bg-[var(--bg-card)] border border-white/10";

  beatsCard.innerHTML = `
    <h3 class="text-2xl font-bold mb-2">Beat Catalogue</h3>
    <p class="text-sm opacity-70 mb-6">Original production available for lease or exclusive purchase.</p>
    <div id="beat-catalogue" class="space-y-6"></div>
    <p class="text-sm opacity-70 mt-6">
      Want to build on this?
      <a href="/?service=production&source=portfolio#booking" class="text-orange-500 font-semibold">Start a session ‚Üí</a>
    </p>
  `;

  grid.appendChild(mixesCard);
  grid.appendChild(beatsCard);
}

document.addEventListener("DOMContentLoaded", renderPortfolio);
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const mixesContainer = document.getElementById("recent-mixes");
  if (!mixesContainer) return;

  PORTFOLIO.mixes.forEach((mix, index) => {
    const card = document.createElement("div");
    card.className = "p-5 rounded-xl";
    card.style.background = 'var(--bg-card)';

    card.innerHTML = `
      <p class="font-semibold">üéµ ${mix.title} ‚Äî ${mix.genre}</p>
      ${mix.badges ? `
        <div class="badges">
          ${mix.badges.map(badge => `<span class="badge">${badge}</span>`).join('')}
        </div>
      ` : ''}
      <p class="text-sm opacity-70 mb-3">${mix.credit}</p>

      <div class="waveform-player" 
           data-before="${mix.before || ''}" 
           data-after="${mix.after}" 
           data-current="after" 
           data-index="${index}">
        <div class="waveform"></div>

        <div class="controls">
          <button class="play-btn">Play</button>
          ${mix.before ? `
            <div class="ab-toggle">
              <button class="ab-btn" data-mode="before">Before</button>
              <span class="separator">/</span>
              <button class="ab-btn active" data-mode="after">After</button>
            </div>
          ` : ''}
        </div>
      </div>
    `;

    mixesContainer.appendChild(card);
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const beatContainer = document.getElementById("beat-catalogue");
  if (!beatContainer) return;

  PORTFOLIO.beats.forEach((beat, index) => {
    const card = document.createElement("div");
    card.className = "p-5 rounded-xl";
    card.style.background = 'var(--bg-card)';

    card.innerHTML = `
      <p class="font-semibold">üéπ ${beat.title} ‚Äî ${beat.genre}</p>
      ${beat.badges ? `
        <div class="badges">
          ${beat.badges.map(badge => `<span class="badge">${badge}</span>`).join('')}
        </div>
      ` : ''}
      <p class="text-sm opacity-70 mb-3">${beat.subtitle}</p>

      <div class="waveform-player" 
           data-after="${beat.src}" 
           data-current="after" 
           data-index="beat-${index}">
        <div class="waveform"></div>

        <div class="controls">
          <button class="play-btn">Play</button>
        </div>
      </div>

      <p class="text-xs opacity-60 mt-3">
        Want to record on this beat? 
        <a href="/?service=production&source=portfolio#booking" class="text-orange-500 font-semibold hover:underline">Start a session ‚Üí</a>
      </p>
    `;

    beatContainer.appendChild(card);
  });
});
</script>

<script>
document.addEventListener("click", e => {
  if (!e.target.classList.contains("mix-toggle")) return;

  const index = e.target.dataset.index;
  const mode = e.target.dataset.mode;
  const mix = PORTFOLIO.mixes[index];

  const player = document.querySelector(`[data-mix-player="${index}"]`);
  const source = player.querySelector("source");

  // 1. Capture state
  const currentTime = player.currentTime;
  const wasPlaying = !player.paused && !player.ended;

  // 2. Swap source
  source.src = mode === "before"
    ? mix.before
    : mix.after;

  // 3. Reload
  player.load();

  // 4. Restore timestamp + playback state
  player.addEventListener("loadedmetadata", function restore() {
    player.currentTime = Math.min(currentTime, player.duration || currentTime);

    if (wasPlaying) {
      player.play().catch(() => {
        /* autoplay restrictions safety */
      });
    }

    player.removeEventListener("loadedmetadata", restore);
  });

  // 5. Visual state
  const buttons = e.target.parentElement.querySelectorAll(".mix-toggle");
  buttons.forEach(btn => {
    btn.classList.toggle("text-orange-500", btn === e.target);
    btn.classList.toggle("opacity-50", btn !== e.target);
  });
});

// Enforce single audio playback across the entire page
document.addEventListener("play", function(e) {
  if (e.target.tagName === "AUDIO") {
    const allAudio = document.querySelectorAll("audio");
    allAudio.forEach(audio => {
      if (audio !== e.target) {
        audio.pause();
      }
    });
  }
}, true);
</script>

<script>
// Service detail content
const SERVICE_DETAILS = {
  recording: {
    description: "Professional studio recording sessions with high-end equipment and an experienced engineer. Whether you're tracking vocals, instruments, or full band sessions, we'll capture your sound with clarity and precision.",
    includes: [
      "Professional recording environment",
      "High-end microphones and preamps",
      "Experienced recording engineer",
      "Session files provided"
    ]
  },
  mixing: {
    description: "Transform your recorded tracks into a polished, professional mix. We'll balance levels, add effects, and ensure every element sits perfectly in the stereo field. Mixing services include unlimited revisions until you're completely satisfied.",
    includes: [
      "Professional mixing with industry-standard plugins",
      "Stereo balance and EQ optimization",
      "Compression and dynamic control",
      "Unlimited revisions",
      "High-quality WAV file delivery"
    ]
  },
  mastering: {
    description: "Final polish for your mixes. Professional mastering ensures your tracks translate well across all playback systems, from earbuds to club sound systems. We'll optimize loudness, add final EQ touches, and prepare your music for distribution.",
    includes: [
      "Professional mastering chain",
      "Loudness optimization for streaming platforms",
      "Final EQ and compression",
      "Stereo enhancement",
      "Distribution-ready files (WAV & MP3)"
    ]
  },
  production: {
    description: "Custom beat production and exclusive licensing. Browse our catalogue of ready-made beats or commission a fully custom production tailored to your sound. All beats include stems and full commercial rights.",
    includes: [
      "High-quality beat production",
      "Stems included (individual tracks)",
      "Commercial rights and licensing",
      "Custom revisions available",
      "WAV file delivery"
    ]
  },
  lessons: {
    description: "One-on-one music production lessons tailored to your skill level and goals. Learn DAW fundamentals, mixing techniques, sound design, arrangement, or work on your own projects with expert guidance.",
    includes: [
      "Personalized 1-on-1 instruction",
      "Flexible curriculum based on your goals",
      "Hands-on learning with professional tools",
      "Session recordings and notes provided",
      "Project feedback and guidance"
    ]
  },
  addons: {
    description: "Enhance your session with professional add-ons. From vocal tuning to rush delivery, these optional extras ensure your project gets the attention and speed it deserves.",
    includes: [
      "Available with any service package",
      "Professional tools and expertise",
      "Quick turnaround options",
      "Premium quality enhancements"
    ]
  }
};

// Modal functionality
function openServiceModal(serviceKey) {
  const modal = document.getElementById('service-modal');
  const modalBody = document.getElementById('service-modal-body');
  const service = PRICING[serviceKey];
  const details = SERVICE_DETAILS[serviceKey];

  if (!service || !details) return;

  const isAddons = serviceKey === 'addons';

  modalBody.innerHTML = `
    <h2 class="text-3xl md:text-4xl font-bold mb-4">${service.label}</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-8">${details.description}</p>

    <div class="mb-8">
      <h3 class="text-xl font-bold mb-4">What's Included</h3>
      <ul class="space-y-3 opacity-80">
        ${details.includes.map(item => `<li>‚Ä¢ ${item}</li>`).join('')}
      </ul>
    </div>

    <div class="mb-8 p-6 rounded-xl" style="background: var(--bg-card); border: 1px solid var(--border-soft);">
      <h3 class="text-xl font-bold mb-4">Pricing</h3>
      <ul class="space-y-2 opacity-80">
        ${service.items.map(item => `
          <li class="flex justify-between">
            <span>${item.label}</span>
            <span>${item.price}</span>
          </li>
        `).join('')}
      </ul>
    </div>

    ${isAddons ? `
      <p class="text-center text-sm opacity-70">
        Add-ons can be selected when booking any service
      </p>
    ` : `
      <a href="/?service=${serviceKey}&source=service-modal#booking"
         class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
         style="background: var(--accent);">
        Book ${service.label}
      </a>
    `}
  `;

  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeServiceModal() {
  const modal = document.getElementById('service-modal');
  modal.classList.remove('active');
  document.body.style.overflow = '';
}

function openHowItWorksModal() {
  const modal = document.getElementById('service-modal');
  const modalBody = document.getElementById('service-modal-body');

  modalBody.innerHTML = `
    <h2 class="text-3xl md:text-4xl font-bold mb-6">How Sessions Work</h2>
    <p class="text-lg opacity-80 leading-relaxed mb-8">
      From booking to delivery, here's what to expect when working with Studio XV.
    </p>

    <div class="space-y-6 mb-8">
      <div>
        <h3 class="text-xl font-bold mb-2">1. Browse Services</h3>
        <p class="opacity-80">Explore our services and pricing. Each service includes detailed information about what's included and expected turnaround times.</p>
      </div>

      <div>
        <h3 class="text-xl font-bold mb-2">2. Book Your Session</h3>
        <p class="opacity-80">Select your service, choose any add-ons, and pay a 50% deposit to secure your booking. We'll confirm your session date and time.</p>
      </div>

      <div>
        <h3 class="text-xl font-bold mb-2">3. Session Day</h3>
        <p class="opacity-80">Arrive on time (or send your files). We'll work together to capture or polish your sound with professional equipment and expertise.</p>
      </div>

      <div>
        <h3 class="text-xl font-bold mb-2">4. Review & Delivery</h3>
        <p class="opacity-80">Receive your files for review. We include revisions to ensure you're completely satisfied with the final result.</p>
      </div>
    </div>

    <a href="#booking"
       onclick="closeServiceModal()"
       class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
       style="background: var(--accent);">
      Book a Session
    </a>
  `;

  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
}

// Close modal handlers
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('service-modal');
  const overlay = document.getElementById('service-modal-overlay');
  const closeBtn = document.getElementById('service-modal-close');

  closeBtn?.addEventListener('click', closeServiceModal);
  overlay?.addEventListener('click', closeServiceModal);

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
      closeServiceModal();
    }
  });
});

function renderServices() {
  const container = document.getElementById("services-grid");
  if (!container) return;

  container.innerHTML = "";

  Object.entries(PRICING).forEach(([key, service]) => {
    const isAddons = key === "addons";

    const card = document.createElement("div");
    card.className = `
      ${isAddons ? "lg:col-span-3" : ""}
      block group rounded-2xl p-8
      border border-white/10
      transition-all duration-300
      hover:-translate-y-2
      hover:border-orange-500
      hover:shadow-xl
      cursor-pointer
    `;

    card.style.background = 'var(--bg-card)';
    card.onclick = () => openServiceModal(key);

    card.innerHTML = `
      <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
        ${service.label}
      </h3>
      <ul class="space-y-4 text-sm">
        ${service.items.map(item => `
          <li class="flex justify-between">
            <span>${item.label}</span>
            <span>${item.price}</span>
          </li>
        `).join("")}
      </ul>
    `;

    container.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded", renderServices);
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const serviceSelect = document.getElementById("service-select");
  const packageSelect = document.getElementById("package-select");
  const packageWrapper = document.getElementById("package-wrapper");
  const hoursWrapper = document.getElementById("hours-wrapper");
  const hoursInput = document.getElementById("hours-input");
  const totalDisplay = document.getElementById("total-display");
  const depositDisplay = document.getElementById("deposit-display");
  const submitButton = document.getElementById("booking-submit");

  // Populate service dropdown from PRICING
  Object.entries(PRICING).forEach(([key, service]) => {
    if (service.type === "addons") return;

    const option = document.createElement("option");
    option.value = key;
    option.textContent = service.label;
    serviceSelect.appendChild(option);
  });

serviceSelect.addEventListener("change", handleServiceChange);
packageSelect.addEventListener("change", calculateTotal);
document.addEventListener("input", calculateTotal);

// Add-ons checkboxes trigger recalculation
document.querySelectorAll(".addon-checkbox").forEach(checkbox => {
  checkbox.addEventListener("change", calculateTotal);
});

// Pre-select service from query parameter
const urlParams = new URLSearchParams(window.location.search);
const serviceParam = urlParams.get('service');
if (serviceParam) {
  const matchingKey = Object.keys(PRICING).find(key => 
    key.toLowerCase() === serviceParam.toLowerCase()
  );
  if (matchingKey && PRICING[matchingKey].type !== 'addons') {
    serviceSelect.value = matchingKey;
    handleServiceChange();
  }
}

function handleServiceChange() {
  const key = serviceSelect.value.toLowerCase();
  const service = PRICING[key];

  resetTotals();
  packageSelect.innerHTML = `<option value="">Choose a package‚Ä¶</option>`;
  packageWrapper.classList.add("hidden");
  hoursWrapper.classList.add("hidden");
  
  const addonsWrapper = document.getElementById("addons-wrapper");
  const hoursLabel = document.getElementById("hours-label");
  const hoursHint = document.getElementById("hours-hint");
  const bookingStatus = document.getElementById("booking-status");

  if (!service) {
    addonsWrapper.classList.remove("hidden");
    bookingStatus.style.opacity = "0";
    return;
  }

  // Update booking status text
  bookingStatus.textContent = `You're booking a ${service.label} session`;
  bookingStatus.style.opacity = "0.7";

  // Update upload hint based on service
  const uploadHint = document.getElementById("upload-hint");
  const uploadHints = {
    mixing: "Send your multi-track stems or full mix for reference. Please include session notes if available.",
    mastering: "Send your mixed track as a stereo WAV file with -6dB headroom for best results.",
    recording: "Reference tracks or demos are welcome but not required.",
    production: "",
    lessons: ""
  };
  
  if (uploadHints[key]) {
    uploadHint.textContent = uploadHints[key];
    uploadHint.style.display = "block";
  } else {
    uploadHint.style.display = "none";
  }

  if (service.type === "hourly") {
    hoursWrapper.classList.remove("hidden");
    hoursInput.min = service.minHours;
    hoursInput.value = service.minHours;
    
    // Lesson-specific UI
    if (key === "lessons") {
      hoursInput.max = service.maxHours || 4;
      hoursLabel.textContent = "Session length";
      hoursHint.textContent = service.coachingCopy || "Structured, guided sessions focused on your goals";
      addonsWrapper.classList.add("hidden");
    } else {
      // Recording or other hourly services
      hoursInput.removeAttribute("max");
      hoursLabel.textContent = "Number of hours";
      hoursHint.textContent = service.suggestions || "Most artists book 2‚Äì4 hours.";
      addonsWrapper.classList.remove("hidden");
    }
  } else {
    // Package-based services (mixing, mastering, production)
    addonsWrapper.classList.remove("hidden");
  }

  if (service.type === "packages") {
    packageWrapper.classList.remove("hidden");
    service.packages.forEach((pkg, index) => {
      const opt = document.createElement("option");
      opt.value = index;

      opt.textContent = pkg.poa
        ? `${pkg.label} ‚Äì POA`
        : `${pkg.label} ‚Äì ¬£${pkg.price}`;

      packageSelect.appendChild(opt);
    });
  }
}

function calculateTotal() {
  const key = serviceSelect.value.toLowerCase();
  const service = PRICING[key];
  if (!service) return;

  let total = 0;
  let hours = null;
  let packageName = null;

  if (service.type === "hourly") {
    hours = Number(hoursInput.value);
    if (!hours || hours < service.minHours) return resetTotals();
    total = hours * service.rate;
    packageName = "Hourly";
  }

  if (service.type === "packages") {
    const pkgIndex = Number(packageSelect.value);
    const pkg = service.packages[pkgIndex];
    if (pkg === undefined) return resetTotals();
    
    packageName = pkg.label;

    // Handle POA (Price on Application)
    if (pkg.poa) {
      totalDisplay.textContent = "Quote required";
      depositDisplay.textContent = "‚Äî";
      submitButton.disabled = false;
      submitButton.textContent = "Request Quote";
      
      window.bookingData = {
        service: service.label,
        package: pkg.label,
        hours: null,
        addons: [],
        total: 0,
        deposit: 0,
        poa: true
      };
      localStorage.setItem("bookingData", JSON.stringify(window.bookingData));
      return;
    }

    total = pkg.price;
  }

  // Process add-ons
  const selectedAddons = [];
  let addonsTotal = 0;

  document.querySelectorAll(".addon-checkbox:checked").forEach(box => {
    const addon = ADDONS[box.value];
    
    if (addon.multiplier) {
      total *= addon.multiplier;
      selectedAddons.push({ label: addon.label, price: `+${Math.round((addon.multiplier - 1) * 100)}%` });
    } else {
      total += addon.price;
      addonsTotal += addon.price;
      selectedAddons.push({ label: addon.label, price: addon.price });
    }
  });

  const deposit = Math.round(total * 0.5);

  totalDisplay.textContent = total.toFixed(2);
  depositDisplay.textContent = deposit.toFixed(2);
  submitButton.disabled = false;
  submitButton.textContent = "Secure Your Session";

  // Display add-ons summary
  const summaryAddons = document.getElementById("summary-addons");
  if (selectedAddons.length > 0) {
    summaryAddons.innerHTML = selectedAddons.map(a =>
      `<div class="flex justify-between text-sm opacity-80">
         <span>${a.label}</span>
         <span>${typeof a.price === 'number' ? '¬£' + a.price : a.price}</span>
       </div>`
    ).join("");
  } else {
    summaryAddons.innerHTML = "";
  }

  window.bookingData = {
    service: service.label,
    package: packageName,
    hours: hours,
    addons: selectedAddons,
    total,
    deposit
  };

  localStorage.setItem("bookingData", JSON.stringify(window.bookingData));
}

function resetTotals() {
  totalDisplay.textContent = "0";
  depositDisplay.textContent = "0";
  submitButton.disabled = true;
}

// Handle form submission and Stripe checkout
const bookingForm = document.querySelector('form[name="booking"]');
bookingForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  // Check if we have booking data
  if (!window.bookingData || window.bookingData.total === 0) {
    alert('Please select a service and configure your booking.');
    return;
  }

  // Safety check: prevent ¬£0 deposits from being processed
  if (!window.bookingData.deposit || window.bookingData.deposit <= 0) {
    alert('Unable to process payment. Please try again.');
    return;
  }

  // Populate metadata fields for Netlify Forms
  const serviceSelect = document.getElementById('service-select');
  const packageSelect = document.getElementById('package-select');
  const hoursInput = document.getElementById('hours-input');
  const fileInput = document.querySelector('input[name="audio"]');
  const cloudLinkInput = document.querySelector('input[name="cloud-link"]');
  
  document.getElementById('metadata-service-type').value = serviceSelect.options[serviceSelect.selectedIndex]?.text || '';
  
  const packageHours = packageSelect.value ? 
    packageSelect.options[packageSelect.selectedIndex]?.text : 
    (hoursInput.value ? `${hoursInput.value} hour(s)` : '');
  document.getElementById('metadata-package-hours').value = packageHours;
  
  document.getElementById('metadata-deposit-amount').value = window.bookingData.deposit || '0';
  document.getElementById('metadata-has-files').value = (fileInput?.files?.length > 0) ? 'true' : 'false';
  document.getElementById('metadata-has-cloud-link').value = (cloudLinkInput?.value?.trim()) ? 'true' : 'false';

  // Store form data for success page
  const formData = {
    name: bookingForm.querySelector('input[name="name"]')?.value || '',
    email: bookingForm.querySelector('input[name="email"]')?.value || '',
    phone: bookingForm.querySelector('input[name="phone"]')?.value || '',
    message: bookingForm.querySelector('textarea[name="message"]')?.value || '',
    date: bookingForm.querySelector('input[name="date"]')?.value || ''
  };
  localStorage.setItem('formData', JSON.stringify(formData));

  // Step 1: Submit to Netlify Forms for email notifications
  try {
    const netlifyFormData = new FormData(bookingForm);
    const netlifyResponse = await fetch('/', {
      method: 'POST',
      body: netlifyFormData
    });
    
    if (!netlifyResponse.ok) {
      throw new Error('Form submission failed');
    }
  } catch (netlifyError) {
    console.error('Form submission error:', netlifyError);
    alert('There was an error submitting your booking. Please try again.');
    return;
  }

  // Step 2: Disable submit button and show loading state
  submitButton.disabled = true;
  const originalText = submitButton.textContent;
  submitButton.textContent = 'Processing...';

  try {
    // Step 3: Proceed to Stripe checkout (Netlify submission successful)
    const response = await fetch('/.netlify/functions/create-checkout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        ...window.bookingData,
        success_url: window.location.origin + '/booking-success'
      })
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || 'Failed to create checkout session');
    }

    // Redirect to Stripe Checkout
    window.location.href = data.url;

  } catch (error) {
    console.error('Checkout error:', error);
    alert('Something went wrong. Please try again or contact us directly.');
    submitButton.disabled = false;
    submitButton.textContent = originalText;
  }
});
});
</script>

<script src="https://unpkg.com/wavesurfer.js@7"></script>

<script>
  // Initialize waveforms after DOM elements are created
  function initWaveforms() {
    const players = [];

    document.querySelectorAll(".waveform-player").forEach(player => {
      const waveformEl = player.querySelector(".waveform");
      const playBtn = player.querySelector(".play-btn");

      const wavesurfer = WaveSurfer.create({
        container: waveformEl,
        waveColor: getComputedStyle(document.documentElement).getPropertyValue('--text-main').trim() || "#666",
        progressColor: "#f97316",
        cursorColor: "#f97316",
        height: 80,
        barWidth: 2,
        barGap: 2,
        responsive: true,
      });

      // Load initial track (after version)
      wavesurfer.load(player.dataset.after);

      playBtn.addEventListener("click", () => {
        // Stop all other waveforms and remove active state
        players.forEach((p, idx) => {
          if (p !== wavesurfer) {
            p.pause();
            document.querySelectorAll('.waveform-player')[idx]?.classList.remove('playing');
          }
        });

        wavesurfer.playPause();
      });

      // Update button text and visual state based on playback
      wavesurfer.on('play', () => {
        playBtn.textContent = 'Pause';
        player.classList.add('playing');
      });

      wavesurfer.on('pause', () => {
        player.classList.remove('playing');
        playBtn.textContent = 'Play';
      });

      wavesurfer.on('finish', () => {
        playBtn.textContent = 'Play';
      });

      // Before/After toggle with seamless playback
      const beforeBtn = player.querySelector('.ab-btn[data-mode="before"]');
      const afterBtn = player.querySelector('.ab-btn[data-mode="after"]');

      if (beforeBtn && afterBtn) {
        const handleToggle = (targetMode) => {
          const isPlaying = wavesurfer.isPlaying();
          const time = wavesurfer.getCurrentTime();

          const next = targetMode === "before" ? player.dataset.before : player.dataset.after;
          
          if (player.dataset.current === targetMode) return; // Already on this version

          player.dataset.current = targetMode;

          wavesurfer.load(next);

          wavesurfer.once("ready", () => {
            wavesurfer.setTime(time);
            if (isPlaying) wavesurfer.play();
          });

          // Update active state
          beforeBtn.classList.toggle('active', targetMode === 'before');
          afterBtn.classList.toggle('active', targetMode === 'after');
        };

        beforeBtn.addEventListener("click", () => handleToggle("before"));
        afterBtn.addEventListener("click", () => handleToggle("after"));
      }

      players.push(wavesurfer);
    });
  }

  // Wait for WaveSurfer library and DOM elements to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(initWaveforms, 100);
    });
  } else {
    setTimeout(initWaveforms, 100);
  }
</script>

</body>
</html>
