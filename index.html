<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Studio XV</title>
  <link rel="icon" type="image/png" href="/favicon.png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Stripe.js for ebook checkout (TEST MODE) -->
  <!-- SAFE TO REMOVE: Delete this line to disable Stripe checkout -->
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    :root {
      /* DARK MODE (DEFAULT) */
      --bg-main: #000000;
      --bg-section: #0d0d0d;
      --bg-card: #111111;
      --bg-soft: #181818;

      --text-main: #ffffff;
      --text-muted: #b5b5b5;

      --accent: #f97316; /* orange */
      --border-soft: rgba(255,255,255,0.12);
    }

    @media (prefers-color-scheme: light) {
      :root {
        /* LIGHT MODE OVERRIDES */
        --bg-main: #ffffff;
        --bg-section: #f5f5f5;
        --bg-card: #ffffff;
        --bg-soft: #eeeeee;

        --text-main: #0b0b0b;
        --text-muted: #555555;

        --border-soft: rgba(0,0,0,0.12);
      }
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-main);
      color: var(--text-main);
      overflow-x: hidden;
    }

    html {
      scroll-behavior: smooth;
    }

    .mobile-link {
      font-weight: 600;
      letter-spacing: 0.05em;
      padding: 0.75rem 0;
      transition: color 0.25s ease;
    }

    section {
      scroll-margin-top: 96px;
    }

    .step {
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .step.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    audio {
      opacity: 0.85;
      transition: opacity 0.2s ease, box-shadow 0.2s ease;
    }

    audio:hover {
      opacity: 1;
      box-shadow: 0 0 0 1px rgba(249,115,22,0.4);
    }

    .badges {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border-soft);
      letter-spacing: 0.04em;
    }

    .waveform {
      height: 80px;
      margin-bottom: 0.75rem;
    }

    .controls {
      display: flex;
      gap: 1rem;
      font-size: 0.85rem;
    }

    .play-btn,
    .toggle-btn {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
    }

    .play-btn:hover,
    .toggle-btn:hover {
      text-decoration: underline;
    }

    .ab-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0;
    }

    .ab-btn {
      background: none;
      border: none;
      padding: 0;
      color: #f97316;
      cursor: pointer;
      font-weight: 500;
      text-decoration: none;
      font-size: inherit;
    }

    .ab-btn:hover {
      text-decoration: underline;
    }

    .ab-btn.active {
      font-weight: 600;
    }

    .separator {
      margin: 0 6px;
      color: #888;
      pointer-events: none;
    }

    .waveform-player.playing {
      background: rgba(249,115,22,0.08);
      border: 1px solid rgba(249,115,22,0.3);
      box-shadow: 0 0 20px rgba(249,115,22,0.15);
      transition: all 0.3s ease;
    }

    /* Booking form micro-interactions */
    input:not([type="file"]),
    select,
    textarea {
      transition: all 0.2s ease;
    }

    input:focus,
    select:focus,
    textarea:focus {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    /* Checkbox animations */
    input[type="checkbox"] {
      transition: transform 0.2s ease;
    }

    input[type="checkbox"]:checked {
      transform: scale(1.1);
    }

    label:has(input[type="checkbox"]:checked) {
      animation: checkboxPulse 0.3s ease;
    }

    @keyframes checkboxPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* Price summary transitions */
    #deposit-display,
    #summary-addons {
      transition: all 0.3s ease;
    }

    #deposit-display.updating {
      animation: priceUpdate 0.4s ease;
    }

    @keyframes priceUpdate {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    .addons-deemphasized {
      opacity: 0.4;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .addons-emphasized {
      opacity: 1;
      pointer-events: auto;
      transition: opacity 0.3s ease;
    }

    /* Subtle reveal animations for form sections */
    @keyframes subtleReveal {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .form-section-reveal {
      animation: subtleReveal 0.3s ease-out;
    }

    #package-wrapper:not(.hidden),
    #hours-wrapper:not(.hidden),
    #time-slot-wrapper:not(.hidden) {
      animation: subtleReveal 0.3s ease-out;
    }

    /* Price summary smooth transitions */
    #payment-clarification {
      transition: opacity 0.3s ease;
    }

    #total-display,
    #deposit-display {
      transition: opacity 0.2s ease;
    }

    /* Accessibility: disable animations for users who prefer reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Light mode form input styling */
    @media (prefers-color-scheme: light) {
      input:not([type="file"]):not([type="checkbox"]),
      select,
      textarea {
        background: white !important;
        border-color: rgba(0,0,0,0.15) !important;
        color: black !important;
      }

      input:not([type="file"]):not([type="checkbox"]):focus,
      select:focus,
      textarea:focus {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }
    }

    /* Mobile spacing improvements */
    @media (max-width: 768px) {
      #booking .space-y-8 > * + * {
        margin-top: 2rem;
      }

      /* Sticky price summary on mobile for better visibility */
      #mobile-price-summary {
        position: sticky;
        top: 0;
        z-index: 10;
        margin-bottom: 1.5rem;
        background: var(--bg-card);
        border: 2px solid var(--border-soft);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      /* Larger tap targets for radio buttons */
      input[type="radio"] {
        min-width: 20px !important;
        min-height: 20px !important;
        width: 20px !important;
        height: 20px !important;
      }

      /* More spacing between radio button labels */
      input[type="radio"] + span {
        padding: 0.5rem 0;
      }

      /* Larger CTA button on mobile */
      #booking-submit {
        height: 4rem !important; /* 64px */
        font-size: 1.125rem; /* 18px */
      }

      /* Increase vertical spacing for better tap accuracy */
      #time-slots-grid {
        gap: 0.75rem !important;
      }

      /* Better touch targets for checkboxes */
      input[type="checkbox"] {
        min-width: 20px;
        min-height: 20px;
      }

      #booking input:not([type="file"]):not([type="checkbox"]),
      #booking select,
      #booking textarea,
      #booking button[type="submit"] {
        min-height: 48px;
        font-size: 16px;
      }

      #booking input[type="checkbox"] {
        width: 24px;
        height: 24px;
        min-width: 24px;
        min-height: 24px;
      }

      #booking label:has(input[type="checkbox"]) {
        padding: 12px 0;
        gap: 16px;
      }

      #booking .rounded-2xl {
        padding: 24px;
      }

      #booking textarea {
        min-height: 120px;
      }
    }

    /* Service Modal */
    #service-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    #service-modal.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    #service-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }

    #service-modal-content {
      position: relative;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 16px;
      padding: 40px;
      animation: modalScale 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes modalScale {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    #service-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border-soft);
      background: var(--bg-card);
    }

    #service-modal-close:hover {
      transform: scale(1.1);
      opacity: 1;
    }

    /* Hide old service detail sections - using modal instead */
    section#recording,
    section#mixing,
    section#mastering,
    section#production,
    section#lessons {
      display: none !important;
    }
  </style>
</head>

<body>

<!-- Service Modal -->
<div id="service-modal">
  <div id="service-modal-overlay"></div>
  <div id="service-modal-content" style="background: var(--bg-soft);">
    <div id="service-modal-close" title="Close">✕</div>
    <div id="service-modal-body"></div>
  </div>
</div>

<!-- NAV -->
<!-- Navigation clarified to separate exploration, learning, listening, and booking. -->
<nav class="fixed top-0 left-0 right-0 z-50 backdrop-blur"
     style="background: var(--bg-main); color: var(--text-main);">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <a href="#home" id="logo-nav" class="text-xl font-bold">Studio XV</a>

    <!-- Desktop -->
    <div class="hidden md:flex space-x-8">
      <a href="#home" class="transition hover:text-[var(--accent)]">Home</a>
      <a href="#services" class="transition hover:text-[var(--accent)]">Services</a>
      <a href="#portfolio" class="transition hover:text-[var(--accent)]">Listen</a>
      <a href="#learn" class="transition hover:text-[var(--accent)]">Learn</a>
      <a href="#booking" class="transition hover:text-[var(--accent)]">Book</a>
    </div>

    <!-- Mobile toggle -->
    <button id="menu-toggle" class="md:hidden text-3xl">☰</button>
  </div>
</nav>

<div id="mobile-menu"
  class="fixed top-0 right-0 h-full w-4/5 max-w-sm
         transform translate-x-full transition-transform duration-300 z-[9999] shadow-2xl"
  style="background: var(--bg-main); color: var(--text-main);">

  <div class="flex justify-end p-6">
    <button id="menu-close" class="text-3xl">✕</button>
  </div>

  <nav class="flex flex-col gap-8 text-center mt-10 text-xl">
    <a href="#home" class="mobile-link hover:text-[var(--accent)]">Home</a>
    <a href="#services" class="mobile-link hover:text-[var(--accent)]">Services</a>
    <a href="#portfolio" class="mobile-link hover:text-[var(--accent)]">Listen</a>
    <a href="#learn" class="mobile-link hover:text-[var(--accent)]">Learn</a>
    <a href="#booking" class="mobile-link hover:text-[var(--accent)]">Book</a>
  </nav>
</div>

<!-- HERO -->
<section id="home" class="min-h-screen pt-24 flex items-center justify-center px-6"
         style="background: var(--bg-main);">
  <div class="text-center space-y-12 w-full max-w-4xl mx-auto">
    <a href="#services" id="logo-hero" class="block">
      <div class="leading-none">
        <div class="tracking-[0.3em] opacity-80">STUDIO</div>
        <div class="text-7xl font-extrabold">XV</div>
      </div>
    </a>

    <div class="space-y-6 max-w-2xl mx-auto">
      <h1 class="text-3xl md:text-4xl font-bold leading-tight">A studio for artists who want their music finished properly.</h1>
      <!-- Homepage orientation: clarifying purpose -->
      <p class="text-lg md:text-xl opacity-80 leading-relaxed">Recording, mixing, mastering, production support, and learning — available remotely or in person.</p>
    </div>

    <a href="#services"
      class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90"
      style="background: var(--accent);">
      Explore Services
    </a>

    <!-- WHAT ARE YOU WORKING ON -->
    <div class="pt-8">
      <p class="text-sm uppercase tracking-wider opacity-50 mb-8">What are you working on?</p>
      
      <div class="flex flex-wrap justify-center gap-x-8 gap-y-4 text-base">
        <a href="#services"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Recording
        </a>
        <a href="#services"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Mixing
        </a>
        <a href="#services"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Mastering
        </a>
        <a href="#services"
           class="hover:text-orange-500 transition underline-offset-4 hover:underline cursor-pointer">
          Beats & Production
        </a>
        <!-- Production Lessons removed from hero list (not needed here, still accessible via Services section and modal system) -->
      </div>
      
      <!-- Contextual lessons note (easily removable) -->
      <p class="text-sm leading-relaxed mt-8 max-w-2xl mx-auto" style="color: var(--text-muted);">
        If you're working through a project and want guidance, one-to-one Zoom lessons and self-paced courses are available alongside sessions.
      </p>
    </div>
  </div>
</section>

<!-- ========================================== -->
<!-- SERVICES SECTION -->
<!-- ========================================== -->
<section id="services" class="pt-16 pb-24 px-6" style="background: var(--bg-section);">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-4">
      Services
    </h2>
    <p class="text-center mb-16">
      <a href="javascript:void(0)" onclick="openHowItWorksModal()" class="text-sm opacity-70 hover:text-orange-500 hover:opacity-100 transition underline-offset-4 hover:underline cursor-pointer">
        How sessions work →
      </a>
    </p>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Recording -->
      <div onclick="openServiceModal('recording')" class="block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Recording
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Hourly Session</span>
            <span data-price="recording.hourly" data-suffix="/hr"></span>
          </li>
          <li class="flex justify-between">
            <span>Half-Day (4hrs)</span>
            <span data-price="recording.packages.half-day.price"></span>
          </li>
          <li class="flex justify-between">
            <span>Full-Day (8hrs)</span>
            <span data-price="recording.packages.full-day.price"></span>
          </li>
        </ul>
      </div>

      <!-- Mixing -->
      <div onclick="openServiceModal('mixing')" class="block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Mixing
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Per Track</span>
            <span data-price="mixing.packages.per-track.price"></span>
          </li>
          <li class="flex justify-between">
            <span>Mix + Master</span>
            <span data-price="mixing.packages.mix-master.price"></span>
          </li>
          <li class="flex justify-between">
            <span>EP (4–6 tracks)</span>
            <span data-price="mixing.packages.ep.price"></span>
          </li>
        </ul>
      </div>

      <!-- Mastering -->
      <div onclick="openServiceModal('mastering')" class="block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Mastering
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Single</span>
            <span data-price="mastering.packages.single.price"></span>
          </li>
          <li class="flex justify-between">
            <span>EP (4–6 tracks)</span>
            <span data-price="mastering.packages.ep.price"></span>
          </li>
          <li class="flex justify-between">
            <span>Album (10+ tracks)</span>
            <span data-price="mastering.packages.album.price"></span>
          </li>
        </ul>
      </div>

      <!-- Production -->
      <div onclick="openServiceModal('production')" class="block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Production
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Beat Lease</span>
            <span data-price="production.packages.beat-lease.price"></span>
          </li>
          <li class="flex justify-between">
            <span>Exclusive Beat</span>
            <span data-price="production.packages.exclusive.price"></span>
          </li>
          <li class="flex justify-between">
            <span>Custom Production</span>
            <span data-price="production.packages.custom.price"></span>
          </li>
        </ul>
      </div>

      <!-- Lessons -->
      <div onclick="openServiceModal('lessons')" class="block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Lessons
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Hourly Session</span>
            <span data-price="lessons.hourly" data-suffix="/hr"></span>
          </li>
          <li class="flex justify-between">
            <span>2-Hour Session</span>
            <span data-price="lessons.packages.2-hour.price"></span>
          </li>
          <li class="flex justify-between">
            <span>4-Hour Session</span>
            <span data-price="lessons.packages.4-hour.price"></span>
          </li>
        </ul>
      </div>

      <!-- Add-Ons -->
      <div onclick="openServiceModal('addons')" class="lg:col-span-3 block group rounded-2xl p-8 border border-white/10 transition-all duration-300 hover:-translate-y-2 hover:border-orange-500 hover:shadow-xl cursor-pointer" style="background: var(--bg-card);">
        <h3 class="text-2xl font-bold mb-6 group-hover:text-orange-500 transition">
          Add-Ons
        </h3>
        <ul class="space-y-4 text-sm">
          <li class="flex justify-between">
            <span>Vocal Tuning</span>
            <span data-price="addons.vocalTuning"></span>
          </li>
          <li class="flex justify-between">
            <span>Stems Export</span>
            <span data-price="addons.stems"></span>
          </li>
          <li class="flex justify-between">
            <span>Rush Delivery</span>
            <span data-price="addons.rush.percentage" data-prefix="+" data-suffix="%"></span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>
<!-- END SERVICES SECTION -->

<!-- This section is locked. Any changes require explicit manual approval. -->
<!-- LOCKED SECTION: PORTFOLIO — DO NOT MODIFY -->
<!-- LOCKED: Legacy production component. Do not modify -->
<section id="portfolio" class="py-32 px-6" style="background: var(--bg-main);">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">Portfolio</h2>
    <div class="grid md:grid-cols-2 gap-12">
      <!-- Left: Recent Mixes -->
      <div>
        <h2 class="text-3xl md:text-4xl font-bold mb-8">Recent Mixes</h2>
        <div class="space-y-8">
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">City Lights</span>
              <span class="text-xs opacity-70">Afro House</span>
            </div>
            <p class="text-xs opacity-60 mb-2">Client project · Independent artist</p>
            <div class="badges mb-2">
              <span class="badge">Produced</span>
              <span class="badge">Mixed</span>
              <span class="badge">Mastered</span>
            </div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/mixes/city-lights-after.mp3" data-before="https://studioxv-media.b-cdn.net/mixes/city-lights-before.mp3" data-current="after" data-index="0">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
                <div class="ab-toggle ml-4">
                  <button class="ab-btn" data-mode="before">Raw</button>
                  <span class="separator">/</span>
                  <button class="ab-btn active" data-mode="after">After</button>
                </div>
              </div>
            </div>
            <p class="text-xs opacity-60 mt-3">
              Like this sound? <a href="#booking" onclick="preselectService('mixing')" class="text-orange-500 font-semibold hover:underline">Book a mixing session →</a>
            </p>
          </div>
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">Midnight Drive</span>
              <span class="text-xs opacity-70">Trap</span>
            </div>
            <p class="text-xs opacity-60 mb-2">Client project · Independent artist</p>
            <div class="badges mb-2">
              <span class="badge">Mastered</span>
            </div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/mixes/midnight-drive-after.mp3" data-before="https://studioxv-media.b-cdn.net/mixes/midnight-drive-before.mp3" data-current="after" data-index="1">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
                <div class="ab-toggle ml-4">
                  <button class="ab-btn" data-mode="before">Raw</button>
                  <span class="separator">/</span>
                  <button class="ab-btn active" data-mode="after">After</button>
                </div>
              </div>
            </div>
            <p class="text-xs opacity-60 mt-3">
              Like this sound? <a href="#booking" onclick="preselectService('mixing')" class="text-orange-500 font-semibold hover:underline">Book a mixing session →</a>
            </p>
          </div>
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">Elevation</span>
              <span class="text-xs opacity-70">Afrobeats</span>
            </div>
            <p class="text-xs opacity-60 mb-2">Client project · Independent artist</p>
            <div class="badges mb-2">
              <span class="badge">Mixed</span>
              <span class="badge">Mastered</span>
            </div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/mixes/Elevation-after.mp3" data-before="https://studioxv-media.b-cdn.net/mixes/Elevation-before.mp3" data-current="after" data-index="2">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
                <div class="ab-toggle ml-4">
                  <button class="ab-btn" data-mode="before">Raw</button>
                  <span class="separator">/</span>
                  <button class="ab-btn active" data-mode="after">After</button>
                </div>
              </div>
            </div>
            <p class="text-xs opacity-60 mt-3">
              Like this sound? <a href="#booking" onclick="preselectService('mixing')" class="text-orange-500 font-semibold hover:underline">Book a mixing session →</a>
            </p>
          </div>
        </div>
      </div>
      <!-- Right: Beat Catalogue -->
      <div>
        <h2 class="text-3xl md:text-4xl font-bold mb-8">Beat Catalogue</h2>
        <div class="space-y-8">
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">Neon Dreams</span>
              <span class="text-xs opacity-70">Trap / Melodic</span>
            </div>
            <div class="text-xs opacity-70 mb-2">D♯ minor · 140 BPM</div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/beats/neon-dreams.mp3" data-current="after" data-index="3">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
              </div>
            </div>
            <div class="text-xs opacity-80 mt-2">Available for lease or exclusive</div>
            <p class="text-xs opacity-60 mt-3">
              Want to record on this beat? <a href="#booking" onclick="preselectService('production')" class="text-orange-500 font-semibold hover:underline">Start a session →</a>
            </p>
          </div>
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">Street Gospel</span>
              <span class="text-xs opacity-70">Afro pop</span>
            </div>
            <div class="text-xs opacity-70 mb-2">D major · 113 BPM</div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/beats/street-gospel.mp3" data-current="after" data-index="4">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
              </div>
            </div>
            <div class="text-xs opacity-80 mt-2">Available for lease or exclusive</div>
            <p class="text-xs opacity-60 mt-3">
              Want to record on this beat? <a href="#booking" onclick="preselectService('production')" class="text-orange-500 font-semibold hover:underline">Start a session →</a>
            </p>
          </div>
          <div class="rounded-xl p-6 border border-white/10" style="background: var(--bg-card);">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">Summer Breeze</span>
              <span class="text-xs opacity-70">Afrobeats</span>
            </div>
            <div class="text-xs opacity-70 mb-2">C minor · 100 BPM</div>
            <div class="waveform-player" data-after="https://studioxv-media.b-cdn.net/beats/summer-breeze.mp3" data-current="after" data-index="5">
              <div class="waveform"></div>
              <div class="controls mt-2">
                <button class="play-btn">Play</button>
              </div>
            </div>
            <div class="text-xs opacity-80 mt-2">Available for lease or exclusive</div>
            <p class="text-xs opacity-60 mt-3">
              Want to record on this beat? <a href="#booking" onclick="preselectService('production')" class="text-orange-500 font-semibold hover:underline">Start a session →</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="text-center mt-16">
      <p class="text-lg opacity-80 mb-6">
        Want your track to sound like this?
      </p>
      <a href="#booking" class="inline-block px-8 py-4 rounded-lg font-semibold text-white" style="background: var(--accent);">Book a Session</a>
    </div>
  </div>
</section>
<!-- END LOCKED SECTION -->

<!-- ========================================== -->
<!-- LEARN SECTION — LOCKED STRUCTURE -->
<!-- DO NOT MODIFY: This section is structurally locked -->
<!-- DO NOT change order, add/remove items, or alter navigation -->
<!-- Content expansion belongs on dedicated pages, not here -->
<!-- ========================================== -->
<section id="learn" class="py-32 px-6 border-t" style="background: var(--bg-section); border-color: var(--border-soft);">
  <div class="max-w-4xl mx-auto">
    
    <!-- LOCKED: Page header and framing copy -->
    <div class="mb-16 max-w-2xl">
      <h2 class="text-4xl md:text-5xl font-bold mb-4">Finish your tracks</h2>
      <p class="text-base opacity-70">
        Clarity, structure, and momentum for unfinished music.
      </p>
    </div>

    <!-- ========================================== -->
    <!-- LOCKED: START HERE ROADMAP -->
    <!-- DO NOT modify steps or order -->
    <!-- ========================================== -->
    <div class="mb-12 pb-12 border-b" style="border-color: var(--border-soft);">
      <ul class="space-y-3 text-base max-w-xl">
        <li><strong>Book a session</strong> — 1-on-1 guidance to move your project forward</li>
        <li><strong>Courses</strong> — 30 mini courses organized by difficulty</li>
        <li><strong>Ebooks</strong> — Step-by-step guides for finishing tracks</li>
        <li><strong>Tools & Templates</strong> — Checklists and reference materials</li>
      </ul>
      <p class="text-sm opacity-60 mt-6 max-w-xl">Start anywhere — most producers combine more than one</p>
    </div>
    <!-- END: Start here roadmap -->
    <!-- ========================================== -->

    <!-- ========================================== -->
    <!-- LOCKED: RESOURCE LINKS -->
    <!-- Three main learning resource categories -->
    <!-- ========================================== -->
    <div class="space-y-4">
      <a href="learn-courses.html" class="block p-6 rounded-lg border transition hover:border-[var(--accent)] hover:transform hover:translate-x-1" style="background: var(--bg-card); border-color: var(--border-soft);">
        <h3 class="text-xl font-semibold mb-2">Courses</h3>
        <p class="text-sm opacity-70">30 mini courses organized by difficulty · £15-£28 each</p>
      </a>
      
      <a href="learn-ebooks.html" class="block p-6 rounded-lg border transition hover:border-[var(--accent)] hover:transform hover:translate-x-1" style="background: var(--bg-card); border-color: var(--border-soft);">
        <h3 class="text-xl font-semibold mb-2">Ebooks</h3>
        <p class="text-sm opacity-70">Step-by-step guides for finishing tracks · £12</p>
      </a>
      
      <a href="learn-tools.html" class="block p-6 rounded-lg border transition hover:border-[var(--accent)] hover:transform hover:translate-x-1" style="background: var(--bg-card); border-color: var(--border-soft);">
        <h3 class="text-xl font-semibold mb-2">Tools & Templates</h3>
        <p class="text-sm opacity-70">Checklists and reference materials · Coming soon</p>
      </a>
    </div>
    <!-- END: Resource links -->
    <!-- ========================================== -->

  </div>
</section>
<!-- ========================================== -->
<!-- END LOCKED SECTION: LEARN -->
<!-- This section is structurally frozen -->
<!-- All future content expansion happens on dedicated pages -->
<!-- ========================================== -->

<!-- ========================================== -->
<!-- LOCKED: FEATURED COURSE TEASER -->
<!-- DO NOT modify structure or add additional courses here -->
<!-- This is a single spotlight section only -->
<!-- Brief introduction linking to full course page -->
<!-- ========================================== -->
<section id="featured-course" class="py-24 px-6 border-t" style="background: var(--bg-main); border-color: var(--border-soft);">
  <div class="max-w-3xl mx-auto">
    
    <div class="space-y-6">
      <div class="space-y-3">
        <h2 class="text-3xl md:text-4xl font-bold">Featured course</h2>
        <h3 class="text-2xl md:text-3xl font-bold">Finishing Tracks Without Overthinking</h3>
        <p class="text-sm opacity-60">Video course · ~75 minutes · Beginner → Intermediate</p>
      </div>
      
      <p class="text-base opacity-80 leading-relaxed">
        Most producers don't struggle with technical skills—they struggle with knowing when to stop, what to prioritize, and how to trust their decisions. This course focuses on the decision-making frameworks that help you finish tracks without second-guessing every choice.
      </p>
      
      <ul class="space-y-2 opacity-80">
        <li>• Identify what matters most in your mix and eliminate unnecessary steps</li>
        <li>• Make clear decisions when you're stuck or second-guessing</li>
        <li>• Build a repeatable finishing process that works for you</li>
        <li>• Know when your track is ready and release it with confidence</li>
      </ul>
      
      <div class="pt-4">
        <div class="inline-block px-8 py-3 rounded-lg text-base font-medium"
           style="background: var(--border-soft); color: var(--text-muted); cursor: not-allowed;">
          Coming soon
        </div>
      </div>
      
      <p class="text-sm opacity-60 pt-2">
        For producers with unfinished tracks who keep tweaking endlessly. Often taken before or alongside a mixing session.
      </p>
    </div>
    
  </div>
</section>
<!-- ========================================== -->
<!-- END LOCKED SECTION: FEATURED COURSE TEASER -->
<!-- ========================================== -->

<!-- ========================================== -->
<!-- BOOKING SECTION -->
<!-- Main booking form - appears only once -->
<!-- ========================================== -->
<section id="booking" class="py-32 px-6" style="background: var(--bg-main);">
  <div class="max-w-3xl mx-auto">
    <!-- Booking reassurance (easily removable) -->
    <p class="text-sm text-center opacity-60 mb-8" style="color: var(--text-muted);">
      Most people explore the work or learning resources first.
    </p>
    
    <h2 class="text-4xl md:text-5xl font-bold text-center mb-16">
      Book Your Session
    </h2>

    <div class="rounded-2xl p-10 shadow-xl" style="background: var(--bg-soft);">

      <p class="text-xs uppercase tracking-wider opacity-50 mb-4 text-center font-semibold">
        Session details
      </p>

      <p id="booking-status" class="text-sm opacity-0 mb-6 text-center transition-opacity duration-300">
        You're booking a session
      </p>

      <form
        name="booking"
        method="POST"
        data-netlify="true"
        netlify-honeypot="bot-field"
        enctype="multipart/form-data"
        class="space-y-8"
      >
        <input type="hidden" name="form-name" value="booking" />
        <input type="hidden" name="subject" value="Studio XV — Booking Request Received (Payment Pending)" />
        <input type="hidden" name="reply-to" value="email" />
        <input type="hidden" name="booking-status" value="⚠️ PAYMENT PENDING - Awaiting Stripe checkout completion" />

        <!-- Booking Metadata (for backend automation) -->
        <input type="hidden" id="metadata-service-type" name="metadata-service-type" value="" />
        <input type="hidden" id="metadata-package-hours" name="metadata-package-hours" value="" />
        <input type="hidden" id="metadata-deposit-amount" name="metadata-deposit-amount" value="" />
        <input type="hidden" id="metadata-has-files" name="metadata-has-files" value="false" />
        <input type="hidden" id="metadata-has-cloud-link" name="metadata-has-cloud-link" value="false" />

        <!-- Honeypot -->
        <p class="hidden">
          <label>
            Don't fill this out:
            <input name="bot-field" />
          </label>
        </p>

        <!-- Service -->
        <!-- BOOKING FORM LOGIC — DO NOT MODIFY WITHOUT EXPLICIT INSTRUCTION -->
        <div>
          <label class="block mb-2 font-semibold">Service</label>
          <select
            name="service"
            id="service-select"
            required
            class="w-full px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          >
            <option value="">Select a service…</option>
            <option value="recording">Recording (from £45/hr)</option>
            <option value="mixing">Mixing (from £85)</option>
            <option value="mastering">Mastering (from £50)</option>
            <option value="production">Production (Beats & Licensing) (from £50)</option>
            <option value="lessons">Lessons (from £45/hr)</option>
          </select>
          <p style="margin-top: 0.5rem; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.7;">Not sure? Choose the closest match — you can change this at any time.</p>
          <p id="service-guidance" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted); opacity: 0; transition: opacity 0.3s ease;"></p>
          <a href="#" id="service-helper-toggle" style="margin-top: 0.5rem; display: block; font-size: 0.8125rem; color: var(--accent); opacity: 0.8; text-decoration: underline; cursor: pointer;">Not sure what to book?</a>
          <div id="service-helper" style="display: none; margin-top: 0.75rem; padding: 0.75rem; background: rgba(255,255,255,0.03); border-radius: 8px; font-size: 0.8125rem; color: var(--text-muted);">
            <ul style="list-style: none; padding: 0; margin: 0; space-y: 0.5rem;">
              <li style="margin-bottom: 0.5rem;"><strong>Recording</strong> → Studio time for vocals and instruments</li>
              <li style="margin-bottom: 0.5rem;"><strong>Mixing</strong> → Balance your recorded tracks</li>
              <li style="margin-bottom: 0.5rem;"><strong>Mastering</strong> → Final polish for release</li>
              <li style="margin-bottom: 0.5rem;"><strong>Production</strong> → Beats and custom tracks</li>
              <li><strong>Lessons</strong> → One-to-one training</li>
            </ul>
          </div>
          <a href="#" id="enquiry-toggle" style="margin-top: 0.75rem; display: block; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.7; text-decoration: none; cursor: pointer;">Not sure what to book? <span style="color: var(--accent); text-decoration: underline;">Make a free enquiry →</span></a>
        </div>
        <!-- Secondary input: shown contextually below -->
        <div id="secondary-input-wrapper" class="mt-4"></div>

        <!-- Package selector -->
        <section id="package-wrapper" class="hidden">
          <label class="block mb-2 font-semibold">Package</label>
          <select
            id="package-select"
            class="w-full px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          >
            <option value="">Choose a package…</option>
          </select>
          <p id="package-guidance" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted); opacity: 0; transition: opacity 0.3s ease;"></p>
        </section>

        <!-- Hours (shown for hourly services only) -->
        <div id="hours-wrapper" class="hidden space-y-2">
          <label class="text-sm opacity-70" id="hours-label">Number of hours</label>
          <input
            type="number"
            id="hours-input"
            min="1"
            value="2"
            class="w-full px-4 py-3 rounded-lg border focus:outline-none"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
          <p class="text-xs opacity-60" id="hours-hint">Most artists book 2–4 hours.</p>
        </div>

        <!-- Add-Ons -->
        <div id="addons-wrapper" class="space-y-3 addons-deemphasized">
          <label class="block font-semibold">Add-Ons (optional)</label>
          <p style="margin-top: 0.25rem; margin-bottom: 0.75rem; font-size: 0.875rem; color: var(--text-muted); opacity: 0.7;">Optional extras — only select what you actually need.</p>
          
          <div>
            <label class="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                class="addon-checkbox w-5 h-5"
                value="vocalTuning"
              />
              <span>Vocal Tuning — £25</span>
            </label>
            <p style="margin-left: 2rem; margin-top: 0.25rem; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.6;">Professional pitch correction for polished vocals.</p>
          </div>

          <div>
            <label class="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                class="addon-checkbox w-5 h-5"
                value="stems"
              />
              <span>Stems Export — £20</span>
            </label>
            <p style="margin-left: 2rem; margin-top: 0.25rem; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.6;">Individual track files for remixing or further editing.</p>
          </div>

          <div>
            <label class="flex items-center gap-3 cursor-pointer">
              <input
                type="checkbox"
                class="addon-checkbox w-5 h-5"
                value="rush"
              />
              <span>Rush Delivery — +<span data-price="addons.rush.percentage" data-suffix="%"></span></span>
            </label>
            <p style="margin-left: 2rem; margin-top: 0.25rem; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.6;">Recommended for tight deadlines.</p>
          </div>
        </div>

        <!-- Date & Time Selection -->
        <div>
          <label class="block mb-2 font-semibold">Preferred Date</label>
          <input
            type="date"
            id="session-date"
            name="preferred-date"
            required
            class="w-full px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main); color-scheme: dark;"
          />
          <p style="margin-top: 0.5rem; font-size: 0.8125rem; color: var(--text-muted); opacity: 0.7;">Sessions are typically available within 3–5 days.</p>
        </div>

        <!-- Time Slot Picker (shows after date selected) -->
        <div id="time-slot-wrapper" class="hidden">
          <label class="block mb-2 font-semibold">Preferred Time</label>
          <p id="availability-status" class="text-sm opacity-70 mb-3">Checking availability...</p>
          <div id="time-slots-grid" class="grid grid-cols-2 md:grid-cols-3 gap-2"></div>
          <input type="hidden" id="session-time" name="session-time" />
          <p style="margin-top: 0.75rem; font-size: 0.875rem; color: var(--text-muted); opacity: 0.7;">We'll confirm availability and reach out if any adjustments are needed.</p>
        </div>

        <!-- Your details -->
        <div class="grid md:grid-cols-2 gap-6">
          <input
            type="text"
            name="name"
            placeholder="Full Name"
            required
            class="px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
          <input
            type="email"
            name="email"
            placeholder="Email"
            required
            class="px-4 py-3 rounded-lg border"
            style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
          />
        </div>

        <input
          type="tel"
          name="phone"
          placeholder="Phone number"
          class="w-full px-4 py-3 rounded-lg border"
          style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
        />

        <!-- Price Summary (moved above optional details for mobile visibility) -->
        <div id="mobile-price-summary" class="rounded-xl p-5 border space-y-2" style="background: var(--bg-card); border-color: var(--border-soft);">
          <!-- Placeholder when nothing selected -->
          <p id="price-placeholder" class="text-center text-sm" style="color: var(--text-muted); opacity: 0.7; padding: 1rem 0;">Select a package to see pricing.</p>
          
          <!-- Price breakdown (hidden until package selected) -->
          <div id="price-breakdown" style="display: none;">
            <!-- Scan-friendly single line price display -->
            <p id="price-summary-line" class="font-medium" style="font-size: 1rem; line-height: 1.5;"></p>

            <div id="summary-addons" class="space-y-1 mt-2" style="font-size: 0.875rem; opacity: 0.75;"></div>

            <p id="payment-helper" class="text-xs mt-3" style="color: var(--text-muted); opacity: 0.6;"></p>
          </div>
        </div>

        <!-- Optional Details Accordion -->
        <details class="rounded-lg border" style="background: var(--bg-card); border-color: var(--border-soft);">
          <summary class="px-4 py-3 font-semibold cursor-pointer select-none" style="color: var(--text-main);">
            Add details (optional)
          </summary>
          <div class="px-4 pb-4 space-y-6 pt-2">
            <!-- File upload -->
            <div>
              <label class="block mb-2 font-semibold">
                Upload audio / stems
              </label>
              <input
                type="file"
                name="audio"
                accept=".mp3,.wav,.zip,.aiff"
                multiple
                class="w-full text-sm
                  file:bg-orange-600 file:text-white
                  file:border-none file:px-4 file:py-2
                  file:rounded-lg file:cursor-pointer
                  hover:file:bg-orange-500"
              />
              <p class="text-xs opacity-60 mt-2">Upload one or more files. For stems, select all files at once. WAV or AIFF preferred. For large sessions, a cloud link may be faster.</p>
            </div>

            <!-- Cloud Storage Link -->
            <div>
              <label class="block mb-2 font-semibold">
                Or provide a cloud storage link
              </label>
              <input
                type="url"
                name="cloud-link"
                placeholder="Dropbox, Google Drive, WeTransfer, etc."
                class="w-full px-4 py-3 rounded-lg border focus:outline-none"
                style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
              />
              <p id="upload-hint" class="text-xs opacity-60 mt-2" style="display: none;"></p>
            </div>

            <!-- Reference Tracks -->
            <div>
              <label class="block mb-2 font-semibold">
                Reference tracks
              </label>
              <input
                type="text"
                name="reference-tracks"
                placeholder="Spotify / YouTube links"
                class="w-full px-4 py-3 rounded-lg border"
                style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
              />
              <p class="text-xs opacity-60 mt-2">Share tracks that inspire your sound.</p>
            </div>

            <!-- Session Goals -->
            <div>
              <label class="block mb-3 font-semibold">Session goals</label>
              <div style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="radio" name="session-goal" value="record-vocals" style="width: 16px; height: 16px;" />
                  <span style="font-size: 0.875rem; color: var(--text-muted);">Record vocals</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="radio" name="session-goal" value="finish-track" style="width: 16px; height: 16px;" />
                  <span style="font-size: 0.875rem; color: var(--text-muted);">Finish a track</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="radio" name="session-goal" value="get-feedback" style="width: 16px; height: 16px;" />
                  <span style="font-size: 0.875rem; color: var(--text-muted);">Get feedback</span>
                </label>
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="radio" name="session-goal" value="unsure" style="width: 16px; height: 16px;" />
                  <span style="font-size: 0.875rem; color: var(--text-muted);">Unsure</span>
                </label>
              </div>
            </div>

            <!-- Notes -->
            <div>
              <label class="block mb-2 font-semibold">
                Project notes
              </label>
              <textarea
                name="details"
                rows="4"
                placeholder="Tell us about your project…"
                class="w-full px-4 py-3 rounded-lg border"
                style="background: var(--bg-card); border-color: var(--border-soft); color: var(--text-main);"
              ></textarea>
            </div>
          </div>
        </details>

        <!-- Promo Code Info -->
        <div class="rounded-lg p-4 border" style="background: var(--bg-soft); border-color: var(--border-soft);">
          <p class="text-sm" style="color: var(--text-muted);">
            💳 <strong>Promo codes</strong> can be applied securely on the Stripe payment page in the next step.
          </p>
        </div>

        <!-- Trust Messages -->
        <p class="text-center text-sm font-medium" style="color: var(--text-muted);">
          Secure checkout powered by Stripe.
        </p>

        <!-- Submit -->
        <button
          type="submit"
          id="booking-submit"
          class="w-full h-14 rounded-lg bg-orange-600 font-bold text-lg hover:bg-orange-500 transition"
          style="box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);"
        >
          Book & Pay Deposit
        </button>

        <p class="text-center text-sm" style="color: var(--text-muted); opacity: 0.7;">
          You'll receive a confirmation email immediately after payment.
        </p>

        <div data-netlify-recaptcha="true"></div>
      </form>

    </div>
  </div>
</section>

<!-- ========================================== -->
<!-- ABOUT SECTION -->
<!-- ========================================== -->
<section id="about" class="py-24 px-6 border-t" style="background: var(--bg-section); border-color: var(--border-soft);">
  <div class="max-w-3xl mx-auto text-center">
    <h2 class="text-4xl md:text-5xl font-bold mb-10">About Studio XV</h2>

    <p class="text-lg leading-relaxed" style="color: var(--text-muted);">
      Studio XV is a professional recording and production space built for
      artists who value sound quality, creative freedom, and a stress-free
      environment. With over 15 years of experience, we specialise in recording,
      mixing, mastering, and production across multiple genres.
    </p>
  </div>
</section>

<footer class="py-12 text-center opacity-70">
  © 2026 Studio XV. All rights reserved.
</footer>

<!-- WaveSurfer.js (local) -->
<script src="/js/wavesurfer.min.js"></script>

<!-- RESTORED FROM LIVE SITE — Portfolio player controls -->
<script src="/js/portfolio-player.js"></script>

<!-- Service Modal & Mobile Menu JavaScript -->
<script>
  // Mobile Menu Toggle
  const menuToggle = document.getElementById('menu-toggle');
  const menuClose = document.getElementById('menu-close');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileLinks = mobileMenu.querySelectorAll('a');

  menuToggle.addEventListener('click', () => {
    mobileMenu.style.transform = 'translateX(0)';
  });

  menuClose.addEventListener('click', () => {
    mobileMenu.style.transform = 'translateX(100%)';
  });

  mobileLinks.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu.style.transform = 'translateX(100%)';
    });
  });

  // Service Modal System
  const serviceModal = document.getElementById('service-modal');
  const modalOverlay = document.getElementById('service-modal-overlay');
  const modalClose = document.getElementById('service-modal-close');
  const modalBody = document.getElementById('service-modal-body');

  // Service content data
  const serviceContent = {
    recording: {
      title: 'Recording',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Recording</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          Professional recording services in a comfortable studio environment designed for capturing your best performance.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">What's Included</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Professional recording equipment and acoustically treated space</li>
              <li>• Engineer to handle technical setup and recording</li>
              <li>• Session files delivered in high-quality WAV format</li>
              <li>• Unlimited takes to get the perfect performance</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Pricing</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Hourly Session — <span data-price="recording.hourly" data-suffix="/hr"></span></li>
              <li>• Half-Day (4hrs) — <span data-price="recording.packages.half-day.price"></span></li>
              <li>• Full-Day (8hrs) — <span data-price="recording.packages.full-day.price"></span></li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Turnaround</h3>
            <p class="opacity-80">Session files delivered within 24 hours of recording.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal('recording')" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book Recording Session
        </a>
      `
    },
    mixing: {
      title: 'Mixing',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Mixing</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          Transform your raw recordings into polished, professional tracks with expert mixing services.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">What's Included</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Balance, EQ, compression, and effects processing</li>
              <li>• Stereo enhancement and spatial placement</li>
              <li>• Up to 3 revisions to ensure you're satisfied</li>
              <li>• High-quality stereo mix delivered in WAV format</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Pricing</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Per Track — <span data-price="mixing.packages.per-track.price"></span></li>
              <li>• Mix + Master — <span data-price="mixing.packages.mix-master.price"></span></li>
              <li>• EP (4–6 tracks) — <span data-price="mixing.packages.ep.price"></span></li>
            </ul>
            <p class="text-sm opacity-60 mt-2">Includes revisions</p>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Turnaround</h3>
            <p class="opacity-80">3–5 days for single tracks. EP projects typically 7–10 days.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal('mixing')" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book Mixing Service
        </a>
      `
    },
    mastering: {
      title: 'Mastering',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Mastering</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          Final polish for your tracks, ensuring they sound consistent and professional across all playback systems.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">What's Included</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Loudness optimization and dynamic control</li>
              <li>• Tonal balance and frequency enhancement</li>
              <li>• Multiple delivery formats (streaming, CD, vinyl-ready)</li>
              <li>• 1 revision included per track</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Pricing</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Single — <span data-price="mastering.packages.single.price"></span></li>
              <li>• EP (4–6 tracks) — <span data-price="mastering.packages.ep.price"></span></li>
              <li>• Album (10+ tracks) — <span data-price="mastering.packages.album.price"></span></li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Turnaround</h3>
            <p class="opacity-80">2–3 days for singles. Albums typically 5–7 days.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal('mastering')" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book Mastering Service
        </a>
      `
    },
    production: {
      title: 'Production',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Production</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          Original beats and custom production tailored to your sound and creative vision.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">What's Included</h3>
            <ul class="space-y-2 opacity-80">
              <li>• High-quality instrumental production</li>
              <li>• Stems provided for mixing flexibility</li>
              <li>• Tagged MP3 preview before purchase</li>
              <li>• License agreement included</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Pricing</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Beat Lease — <span data-price="production.packages.beat-lease.price"></span></li>
              <li>• Exclusive Beat — <span data-price="production.packages.exclusive.price"></span></li>
              <li>• Custom Production — <span data-price="production.packages.custom.price"></span> (based on scope)</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Turnaround</h3>
            <p class="opacity-80">Beat leases delivered instantly. Custom production 7–14 days depending on complexity.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal('production')" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book Production Service
        </a>
      `
    },
    lessons: {
      title: 'Lessons',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Production Lessons</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          One-to-one sessions focused on your specific production challenges and goals. Available via Zoom or in-studio.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">What's Included</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Live screen-sharing and real-time feedback</li>
              <li>• Personalized guidance on your projects</li>
              <li>• Focus on arrangement, mixing, sound design, or workflow</li>
              <li>• Session recording provided for later review</li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Pricing</h3>
            <ul class="space-y-2 opacity-80">
              <li>• Hourly Session — <span data-price="lessons.hourly" data-suffix="/hr"></span></li>
              <li>• 2-Hour Session — <span data-price="lessons.packages.2-hour.price"></span></li>
              <li>• 4-Hour Session — <span data-price="lessons.packages.4-hour.price"></span></li>
            </ul>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Format</h3>
            <p class="opacity-80">All lessons conducted via Zoom. Flexible scheduling available.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal('lessons')" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book a Lesson
        </a>
      `
    },
    addons: {
      title: 'Add-Ons',
      content: `
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Add-Ons</h2>
        <p class="text-lg opacity-80 leading-relaxed mb-8">
          Enhance your session with additional services for a polished, professional result.
        </p>

        <div class="space-y-6 mb-8">
          <div>
            <h3 class="text-xl font-bold mb-2">Vocal Tuning — <span data-price="addons.vocalTuning"></span></h3>
            <p class="opacity-80">Professional pitch correction and timing adjustments to ensure your vocals sound natural and polished.</p>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Stems Export — <span data-price="addons.stems"></span></h3>
            <p class="opacity-80">Individual track stems delivered for DJ use, remixes, or archival purposes.</p>
          </div>

          <div>
            <h3 class="text-xl font-bold mb-2">Rush Delivery — +<span data-price="addons.rush.percentage" data-suffix="%"></span></h3>
            <p class="opacity-80">Expedited turnaround for urgent projects. Your mix or master prioritized and delivered within 24–48 hours.</p>
          </div>
        </div>

        <a href="#booking" onclick="closeServiceModal()" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
          Book with Add-Ons
        </a>
      `
    }
  };

  // Open service modal
  function openServiceModal(serviceType) {
    const service = serviceContent[serviceType];
    if (service) {
      modalBody.innerHTML = service.content;
      serviceModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
  }

  // Open "How It Works" modal
  function openHowItWorksModal() {
    modalBody.innerHTML = `
      <h2 class="text-3xl md:text-4xl font-bold mb-6">How Sessions Work</h2>
      <p class="text-lg opacity-80 leading-relaxed mb-8">
        From booking to delivery, here's what to expect when working with Studio XV.
      </p>

      <div class="space-y-6 mb-8">
        <div>
          <h3 class="text-xl font-bold mb-2">1. Browse Services</h3>
          <p class="opacity-80">Explore our services and pricing. Each service includes detailed information about what's included and expected turnaround times.</p>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-2">2. Book Your Session</h3>
          <p class="opacity-80">Select your service, choose any add-ons, and pay a 50% deposit to secure your booking. We'll confirm your session date and time.</p>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-2">3. Session Day</h3>
          <p class="opacity-80">Arrive on time (or send your files). We'll work together to capture or polish your sound with professional equipment and expertise.</p>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-2">4. Review &amp; Delivery</h3>
          <p class="opacity-80">Receive your files for review. We include revisions to ensure you're completely satisfied with the final result.</p>
        </div>
      </div>

      <a href="#booking" onclick="closeServiceModal()" class="inline-block px-10 py-4 rounded-lg text-lg font-semibold text-white transition hover:opacity-90" style="background: var(--accent);">
        Book a Session
      </a>
    `;
    serviceModal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // Close modal
  function closeServiceModal(service) {
    serviceModal.classList.remove('active');
    document.body.style.overflow = '';
    
    // If a service is provided, auto-select it in the booking form
    if (service) {
      setTimeout(() => {
        const serviceSelect = document.getElementById('service-select');
        if (serviceSelect) {
          serviceSelect.value = service;
          // Trigger change event to update form
          const event = new Event('change', { bubbles: true });
          serviceSelect.dispatchEvent(event);
        }
      }, 100);
    }
  }

  // Close modal on overlay click
  modalOverlay.addEventListener('click', closeServiceModal);
  
  // Close modal on close button click
  modalClose.addEventListener('click', closeServiceModal);

  // Close modal on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && serviceModal.classList.contains('active')) {
      closeServiceModal();
    }
  });

  // Make functions globally accessible
  window.openServiceModal = openServiceModal;
  window.openHowItWorksModal = openHowItWorksModal;
  window.closeServiceModal = closeServiceModal;
</script>

<!-- Booking Form Logic -->
<script>
  // Booking form state and pricing
  const bookingState = {
    service: '',
    hours: 2,
    package: '',
    addons: [],
    // 🎯 Raw numeric values for calculations and API calls
    totalAmount: 0,
    depositAmount: 0,
    balanceAmount: 0
  };

  // ========================================
  // CENTRALIZED PRICING CONFIG
  // Change prices here and they update everywhere
  // ========================================
  const pricing = {
    recording: {
      hourly: 45,
      packages: {
        'half-day': { hours: 4, price: 160 },
        'full-day': { hours: 8, price: 300 }
      }
    },
    mixing: {
      packages: {
        'per-track': { price: 90, label: 'Per Track — £90' },
        'mix-master': { price: 120, label: 'Mix + Master — £120' },
        'ep': { price: 450, label: 'EP (4–6 tracks) — £450' }
      }
    },
    mastering: {
      packages: {
        'single': { price: 50, label: 'Single — £50' },
        'ep': { price: 180, label: 'EP (4–6 tracks) — £180' },
        'album': { price: 350, label: 'Album (10+ tracks) — £350' }
      }
    },
    production: {
      packages: {
        'beat-lease': { price: 50, label: 'Beat Lease — £50' },
        'exclusive': { price: 200, label: 'Exclusive Beat — £200' },
        'custom': { price: 600, label: 'Custom Production — from £600' }
      }
    },
    lessons: {
      hourly: 45,
      packages: {
        '2-hour': { hours: 2, price: 85 },
        '4-hour': { hours: 4, price: 160 }
      }
    },
    addons: {
      vocalTuning: 35,
      stems: 30,
      rush: { percentage: 75 },  // 75% of base price - change this number to update everywhere
      sameDay: { percentage: 75 } // 75% of base price - not yet implemented
    }
  };

  // ========================================
  // AUTO-POPULATE PRICES FROM CONFIG
  // ========================================
  function populatePrices() {
    // Find all elements with data-price attribute
    const priceElements = document.querySelectorAll('[data-price]');
    
    priceElements.forEach(element => {
      const path = element.getAttribute('data-price');
      const prefix = element.getAttribute('data-prefix') || '';
      const suffix = element.getAttribute('data-suffix') || '';
      
      // Navigate through pricing object using path (e.g., "recording.hourly")
      const keys = path.split('.');
      let value = pricing;
      
      for (const key of keys) {
        value = value?.[key];
      }
      
      // Set the text content with price
      if (value !== undefined && value !== null) {
        // If suffix is %, it's a percentage - don't add £ symbol
        if (suffix === '%') {
          element.textContent = `${prefix}${value}${suffix}`;
        } else {
          element.textContent = `${prefix}£${value}${suffix}`;
        }
      }
    });
  }

  // Populate prices immediately
  populatePrices();

  // ========================================
  // SERVICE HELPER TOGGLE
  // ========================================
  const serviceHelperToggle = document.getElementById('service-helper-toggle');
  const serviceHelper = document.getElementById('service-helper');
  
  if (serviceHelperToggle && serviceHelper) {
    serviceHelperToggle.addEventListener('click', function(e) {
      e.preventDefault();
      if (serviceHelper.style.display === 'none') {
        serviceHelper.style.display = 'block';
        serviceHelperToggle.textContent = 'Hide service guide';
      } else {
        serviceHelper.style.display = 'none';
        serviceHelperToggle.textContent = 'Not sure what to book?';
      }
    });
  }

  // ========================================
  // HANDLE URL PARAMETERS FOR SERVICE PRE-SELECTION
  // ========================================
  const urlParams = new URLSearchParams(window.location.search);
  const preselectedService = urlParams.get('service');
  
  if (preselectedService && serviceSelect) {
    // Set the service dropdown value
    serviceSelect.value = preselectedService;
    // Trigger change event to show appropriate package options
    serviceSelect.dispatchEvent(new Event('change'));
  }
  
  // Also populate when modal opens (for dynamically loaded content)
  const originalOpenModal = window.openServiceModal;
  if (originalOpenModal) {
    window.openServiceModal = function(serviceKey) {
      originalOpenModal(serviceKey);
      setTimeout(populatePrices, 10);
    };
  }

  // Get DOM elements
  const serviceSelect = document.getElementById('service-select');
  const hoursWrapper = document.getElementById('hours-wrapper');
  const hoursInput = document.getElementById('hours-input');
  const packageWrapper = document.getElementById('package-wrapper');
  const packageSelect = document.getElementById('package-select');
  const totalDisplay = document.getElementById('total-display');
  const depositDisplay = document.getElementById('deposit-display');
  const summaryAddons = document.getElementById('summary-addons');
  const addonCheckboxes = document.querySelectorAll('.addon-checkbox');
  const sessionDateInput = document.getElementById('session-date');
  const sessionDateWrapper = sessionDateInput?.closest('div'); // Parent div
  const sessionTimeInput = document.getElementById('session-time'); // ✅ Hidden input for selected time
  const timeSlotWrapper = document.getElementById('time-slot-wrapper');

  // 🎯 SERVICE RULES - Define session vs non-session services
  const SESSION_SERVICES = ['recording', 'mixing', 'mastering', 'lessons'];
  
  // Helper: Check if service requires session date/time
  function isSessionService(service) {
    return SESSION_SERVICES.includes(service);
  }

  // Service selection handler
  serviceSelect.addEventListener('change', function() {
    const service = this.value;
    bookingState.service = service;
    bookingState.package = '';
    
    // Update service guidance text
    const serviceGuidance = document.getElementById('service-guidance');
    const guidanceText = {
      'recording': 'Professional studio time for vocals and instruments. Book by the hour or choose a package.',
      'mixing': 'Balance and refine your recorded tracks. Bring stems or individual files.',
      'mastering': 'Final polish for release-ready sound. Perfect for singles, EPs, and albums.',
      'lessons': 'One-to-one production training. Tailored to your current skill level.',
      'production': 'Beats, custom production, and collaboration. No studio session required.'
    };
    
    if (service && guidanceText[service]) {
      serviceGuidance.textContent = guidanceText[service];
      serviceGuidance.style.opacity = '1';
    } else {
      serviceGuidance.style.opacity = '0';
    }
    
    // Update package guidance text
    const packageGuidance = document.getElementById('package-guidance');
    const packageGuidanceText = {
      'recording': 'Most artists choose Half Day for vocals or Full Day for full tracks.',
      'mixing': 'Single Track is ideal for one song. EP and Album are best for cohesive projects.',
      'mastering': 'Choose Single Track for releases, EP or Album for consistent sound.',
      'lessons': 'Sessions are tailored to your level — beginners welcome.',
      'production': 'Licensing and custom options are confirmed after checkout.'
    };
    
    if (service && packageGuidanceText[service]) {
      packageGuidance.textContent = packageGuidanceText[service];
      packageGuidance.style.opacity = '1';
    } else {
      packageGuidance.style.opacity = '0';
    }
    
    // Reset displays
    hoursWrapper.classList.add('hidden');
    packageWrapper.classList.add('hidden');
    packageSelect.innerHTML = '<option value="">Choose a package…</option>';
    
    // 🎯 Show/hide date/time based on service type
    if (sessionDateWrapper) {
      if (isSessionService(service)) {
        sessionDateWrapper.classList.remove('hidden');
        sessionDateInput.required = true;
      } else {
        sessionDateWrapper.classList.add('hidden');
        timeSlotWrapper?.classList.add('hidden');
        sessionDateInput.required = false;
        sessionDateInput.value = '';
      }
    }
    
    if (!service) {
      calculateTotal();
      return;
    }

    // Show appropriate options based on service
    if (service === 'recording' || service === 'lessons') {
      // Hourly services - show package options first (hours come after package selection)
      packageWrapper.classList.remove('hidden');
      
      const packages = pricing[service].packages;
      Object.keys(packages).forEach(key => {
        const pkg = packages[key];
        const option = document.createElement('option');
        option.value = key;
        option.textContent = `${key.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())} (${pkg.hours}hrs) — £${pkg.price}`;
        packageSelect.appendChild(option);
      });
      
      // Add hourly option
      const hourlyOption = document.createElement('option');
      hourlyOption.value = 'hourly';
      hourlyOption.textContent = `Hourly — £${pricing[service].hourly}/hr`;
      packageSelect.insertBefore(hourlyOption, packageSelect.firstChild.nextSibling);
      
    } else {
      // Package-only services (mixing, mastering, production)
      packageWrapper.classList.remove('hidden');
      
      const packages = pricing[service].packages;
      Object.keys(packages).forEach(key => {
        const pkg = packages[key];
        const option = document.createElement('option');
        option.value = key;
        option.textContent = pkg.label;
        packageSelect.appendChild(option);
      });
    }
    
    calculateTotal();
  });

  // Package selection handler
  packageSelect.addEventListener('change', function() {
    bookingState.package = this.value;
    
    // Emphasize add-ons section when package is selected
    const addonsWrapper = document.getElementById('addons-wrapper');
    if (this.value && addonsWrapper) {
      addonsWrapper.classList.remove('addons-deemphasized');
      addonsWrapper.classList.add('addons-emphasized');
    }
    
    // Show/hide hours input based on package selection
    if (bookingState.package === 'hourly' && (bookingState.service === 'recording' || bookingState.service === 'lessons')) {
      hoursWrapper.classList.remove('hidden');
    } else {
      hoursWrapper.classList.add('hidden');
    }
    
    calculateTotal();
  });

  // Hours input handler
  hoursInput.addEventListener('input', function() {
    bookingState.hours = parseInt(this.value) || 1;
    if (bookingState.package === 'hourly') {
      calculateTotal();
    }
  });

  // Addon checkboxes handler
  addonCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      if (this.checked) {
        bookingState.addons.push(this.value);
      } else {
        bookingState.addons = bookingState.addons.filter(a => a !== this.value);
      }
      calculateTotal();
    });
  });

  // Calculate total price
  function calculateTotal() {
    let basePrice = 0;
    const service = bookingState.service;
    const pkg = bookingState.package;
    
    if (!service || !pkg) {
      // Clear numeric values
      bookingState.totalAmount = 0;
      bookingState.depositAmount = 0;
      bookingState.balanceAmount = 0;
      updatePriceDisplay(0, 0, [], false);
      return;
    }
    
    // Calculate base price
    if (pkg === 'hourly') {
      basePrice = pricing[service].hourly * bookingState.hours;
    } else if (pkg && pricing[service].packages[pkg]) {
      basePrice = pricing[service].packages[pkg].price;
    }
    
    // Calculate addons
    let addonTotal = 0;
    const addonDetails = [];
    
    bookingState.addons.forEach(addon => {
      if (pricing.addons[addon]?.percentage) {
        // Percentage-based addon (Rush, Same-Day, etc.)
        const percentage = pricing.addons[addon].percentage / 100;
        const addonCost = Math.round(basePrice * percentage);
        addonTotal += addonCost;
        const addonName = addon === 'rush' ? 'Rush Delivery' : addon === 'sameDay' ? 'Same-Day Turnaround' : addon;
        addonDetails.push({ name: addonName, cost: addonCost });
      } else {
        addonTotal += pricing.addons[addon];
        const addonName = addon === 'vocalTuning' ? 'Vocal Tuning' : addon === 'stems' ? 'Stems Export' : addon;
        addonDetails.push({ name: addonName, cost: pricing.addons[addon] });
      }
    });
    
    const total = basePrice + addonTotal;
    
    // 🎯 Calculate deposit based on service type
    const deposit = isSessionService(service) ? Math.round(total * 0.5) : total;
    const balance = total - deposit;
    
    // 🎯 Store numeric values in bookingState for API calls
    bookingState.totalAmount = total;
    bookingState.depositAmount = deposit;
    bookingState.balanceAmount = balance;
    
    updatePriceDisplay(total, deposit, addonDetails, true);
  }

  // Update price display
  function updatePriceDisplay(total, deposit, addonDetails = [], hasPackage = false) {
    const pricePlaceholder = document.getElementById('price-placeholder');
    const priceBreakdown = document.getElementById('price-breakdown');
    const priceSummaryLine = document.getElementById('price-summary-line');
    const paymentHelper = document.getElementById('payment-helper');
    
    // Show placeholder or breakdown
    if (!hasPackage) {
      pricePlaceholder.style.display = 'block';
      priceBreakdown.style.display = 'none';
      return;
    }
    
    pricePlaceholder.style.display = 'none';
    priceBreakdown.style.display = 'block';
    
    const service = bookingState.service;
    const isSession = isSessionService(service);
    
    // Build scan-friendly price line
    if (isSession) {
      // Deposit-based session services: "Total: £X | Paying today: £Y | Balance later: £Z"
      const balance = total - deposit;
      priceSummaryLine.innerHTML = `Total: £${total} <span style="opacity: 0.4; margin: 0 0.5rem;">|</span> Paying today: £${deposit} <span style="opacity: 0.4; margin: 0 0.5rem;">|</span> Balance later: £${balance}`;
      paymentHelper.textContent = 'Balance due at session start.';
    } else {
      // Full-payment services: "Paying today: £X (paid in full)"
      priceSummaryLine.innerHTML = `Paying today: £${total} <span style="opacity: 0.6;">(paid in full)</span>`;
      paymentHelper.textContent = 'Payment is taken in full today.';
    }
    
    // Update addon summary
    summaryAddons.innerHTML = '';
    addonDetails.forEach(addon => {
      const addonLine = document.createElement('div');
      addonLine.className = 'flex justify-between text-sm';
      addonLine.innerHTML = `<span>+ ${addon.name}</span><span>£${addon.cost}</span>`;
      summaryAddons.appendChild(addonLine);
    });
    
    // Update button text based on payment type
    const bookingSubmitBtn = document.getElementById('booking-submit');
    if (bookingSubmitBtn) {
      if (isSession) {
        bookingSubmitBtn.textContent = 'Book & Pay Deposit';
      } else {
        bookingSubmitBtn.textContent = 'Pay & Confirm Booking';
      }
    }
    
    // Add animation
    priceSummaryLine.classList.add('updating');
    setTimeout(() => priceSummaryLine.classList.remove('updating'), 400);
  }

  // Initialize
  calculateTotal();

  // ========================================
  // TIME SLOT AVAILABILITY SYSTEM
  // ========================================
  // sessionDateInput, sessionTimeInput, timeSlotWrapper declared above
  const timeSlotsGrid = document.getElementById('time-slots-grid');
  const availabilityStatus = document.getElementById('availability-status');

  // Business hours: 9:00 - 22:00 (Europe/London)
  const BUSINESS_START = 9;
  const BUSINESS_END = 22;

  // Track selected time slot
  let selectedTimeSlot = null;

  // Get session duration in hours
  function getSessionDuration() {
    const service = bookingState.service;
    const pkg = bookingState.package;
    
    if (!service || !pkg) return 2; // Default 2 hours
    
    // If hourly package, use hours input
    if (pkg === 'hourly') {
      return bookingState.hours;
    }
    
    // If package, get hours from package definition
    if (pricing[service]?.packages?.[pkg]?.hours) {
      return pricing[service].packages[pkg].hours;
    }
    
    return 2; // Default
  }

  // Populate time slots from available slots returned by backend
  function populateTimeSlots(availableSlots = []) {
    const duration = getSessionDuration();
    timeSlotsGrid.innerHTML = '';
    
    console.log(`📋 Populating ${availableSlots.length} available time slots (${duration}hr session)`);
    
    if (availableSlots.length === 0) {
      timeSlotsGrid.innerHTML = '<p class=\"col-span-full text-center opacity-60\">No available slots for this date. Please choose another date.</p>';
      return;
    }
    
    // Display each available slot
    availableSlots.forEach(startTime => {
      const [hour] = startTime.split(':').map(Number);
      const endHour = hour + duration;
      const endTime = `${endHour.toString().padStart(2, '0')}:00`;
      
      // Create time slot button
      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'px-4 py-3 rounded-lg text-sm font-medium transition hover:bg-orange-600 hover:text-white cursor-pointer';
      button.style.cssText = `
        background: var(--bg-card);
        border: 1px solid var(--border-soft);
        color: var(--text-main);
      `;
      button.textContent = `${startTime} - ${endTime}`;
      
      button.addEventListener('click', function() {
        selectTimeSlot(this, startTime);
      });
      
      timeSlotsGrid.appendChild(button);
    });
  }

  // Select a time slot
  function selectTimeSlot(button, time) {
    // Remove previous selection
    const buttons = timeSlotsGrid.querySelectorAll('button');
    buttons.forEach(btn => {
      btn.style.background = 'var(--bg-card)';
      btn.style.color = 'var(--text-main)';
      btn.style.borderColor = 'var(--border-soft)';
    });
    
    // Highlight selected
    button.style.background = 'var(--accent)';
    button.style.color = '#ffffff';
    button.style.borderColor = 'var(--accent)';
    
    selectedTimeSlot = time;
    
    // ✅ Safely set hidden input value (guard against null)
    if (sessionTimeInput) {
      sessionTimeInput.value = time;
    }
    
    console.log('✅ Selected time:', time);
  }

  // Fetch availability from server
  async function checkAvailability(date) {
    try {
      console.log('🔍 Checking availability for:', date);
      
      availabilityStatus.textContent = 'Checking availability...';
      availabilityStatus.style.color = 'var(--text-muted)';
      
      const response = await fetch(`/.netlify/functions/check-availability?date=${date}`);
      
      if (!response.ok) {
        throw new Error('Failed to check availability');
      }
      
      const data = await response.json();
      
      console.log('✅ Availability response:', data);
      console.log(`📊 Available slots: ${data.availableSlots?.length || 0}`);
      
      // Update status message
      if (data.availableSlots && data.availableSlots.length > 0) {
        availabilityStatus.textContent = `${data.availableSlots.length} slot(s) available`;
        availabilityStatus.style.color = 'var(--accent)';
      } else {
        availabilityStatus.textContent = 'No availability for this date';
        availabilityStatus.style.color = '#ef4444';
      }
      
      // Populate time slots from available slots
      populateTimeSlots(data.availableSlots || []);
      
    } catch (error) {
      console.error('❌ Availability check error:', error);
      availabilityStatus.textContent = 'Unable to check availability. Please try again.';
      availabilityStatus.style.color = '#ef4444';
      
      // Show empty state
      populateTimeSlots([]);
    }
  }

  // Date selection handler
  if (sessionDateInput) {
    sessionDateInput.addEventListener('change', function() {
      const selectedDate = this.value;
      
      if (!selectedDate) {
        timeSlotWrapper.classList.add('hidden');
        return;
      }
      
      // Ensure service and package are selected
      if (!bookingState.service || !bookingState.package) {
        alert('Please select a service and package first');
        this.value = '';
        return;
      }
      
      console.log('📅 Date selected:', selectedDate);
      
      // 🎯 BYPASS: Non-session services don't need time slots
      if (!isSessionService(bookingState.service)) {
        console.log('⏭️ Bypassing availability check - non-session service');
        timeSlotWrapper.classList.add('hidden');
        return;
      }
      
      // Show time slot picker
      timeSlotWrapper.classList.remove('hidden');
      
      // Reset selected time
      selectedTimeSlot = null;
      
      // ✅ Safely reset hidden input (guard against null)
      if (sessionTimeInput) {
        sessionTimeInput.value = '';
      }
      
      // Check availability
      checkAvailability(selectedDate);
    });
  }

  // Handle form submission with Stripe checkout
  const bookingForm = document.querySelector('form[name="booking"]');
  const bookingSubmit = document.getElementById('booking-submit');
  
  // ========================================
  // PRESELECT SERVICE HELPER FOR PORTFOLIO LINKS
  // ========================================
  function preselectService(service) {
    setTimeout(() => {
      if (serviceSelect) {
        serviceSelect.value = service;
        serviceSelect.dispatchEvent(new Event('change'));
      }
    }, 100);
  }
  
  bookingForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Validate form
    if (!bookingState.service || !bookingState.package) {
      alert('Please select a service and package');
      return;
    }
    
    // Disable button and show loading
    bookingSubmit.disabled = true;
    bookingSubmit.textContent = 'Processing...';
    
    try {
      // Calculate final pricing
      let basePrice = 0;
      const service = bookingState.service;
      const pkg = bookingState.package;
      
      if (pkg === 'hourly') {
        basePrice = pricing[service].hourly * bookingState.hours;
      } else if (pkg && pricing[service].packages[pkg]) {
        basePrice = pricing[service].packages[pkg].price;
      }
      
      // Calculate addon costs for line items
      const addonsList = [];
      bookingState.addons.forEach(addon => {
        if (pricing.addons[addon]?.percentage) {
          // Percentage-based addon (Rush, Same-Day, etc.)
          const percentage = pricing.addons[addon].percentage / 100;
          const addonCost = Math.round(basePrice * percentage);
          const addonName = addon === 'rush' ? 'Rush Delivery' : addon === 'sameDay' ? 'Same-Day Turnaround' : addon;
          addonsList.push({ label: `${addonName} (+${pricing.addons[addon].percentage}%)`, price: addonCost });
        } else {
          const addonName = addon === 'vocalTuning' ? 'Vocal Tuning' : addon === 'stems' ? 'Stems Export' : addon;
          addonsList.push({ label: addonName, price: pricing.addons[addon] });
        }
      });
      
      // 🎯 Use numeric values from bookingState (already calculated in calculateTotal)
      const total = bookingState.totalAmount;
      const deposit = bookingState.depositAmount;
      
      // Get package name for display
      let packageName = pkg;
      if (pkg === 'hourly') {
        packageName = `Hourly (${bookingState.hours}hrs)`;
      } else if (pricing[service].packages[pkg]) {
        // Use .label if available, otherwise use formatted pkg name
        packageName = pricing[service].packages[pkg].label || pkg.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
      }
      
      // Get customer info from form
      const customerName = document.querySelector('input[name="name"]')?.value || '';
      const customerEmail = document.querySelector('input[name="email"]')?.value || '';
      
      // 🎯 Get session date/time ONLY for session services
      const sessionDate = isSessionService(service) ? (document.getElementById('session-date')?.value || '') : '';
      const sessionTime = isSessionService(service) ? (document.getElementById('session-time')?.value || '') : '';
      
      // Validate session services require date/time
      if (isSessionService(service) && (!sessionDate || !sessionTime)) {
        alert('Please select a date and time for your session');
        bookingSubmit.disabled = false;
        bookingSubmit.textContent = 'Submit Booking Request';
        return;
      }
      
      // Call Netlify function to create Stripe checkout
      const response = await fetch('/.netlify/functions/create-checkout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          service: service.charAt(0).toUpperCase() + service.slice(1),
          packageName: packageName,
          hours: pkg === 'hourly' ? bookingState.hours : null,
          addons: addonsList,
          total: total,
          deposit: deposit,
          sessionDate: sessionDate,
          sessionTime: sessionTime,
          customerName: customerName,
          customerEmail: customerEmail
        })
      });
      
      const data = await response.json();
      
      if (response.ok && data.url) {
        // Redirect to Stripe Checkout
        window.location.href = data.url;
      } else {
        throw new Error(data.error || 'Failed to create checkout session');
      }
      
    } catch (error) {
      console.error('Checkout error:', error);
      alert('Sorry, there was an error processing your booking. Please try again or contact us directly.');
      
      // Re-enable button
      bookingSubmit.disabled = false;
      bookingSubmit.textContent = 'Submit Booking Request';
    }
  });
</script>

<!-- ========================================== -->
<!-- ENQUIRY MODAL -->
<!-- ========================================== -->
<div id="enquiry-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow-y: auto; padding: 20px;">
  <div style="max-width: 600px; margin: 40px auto; background: var(--bg-card); border-radius: 12px; padding: 32px; position: relative;">
    <button id="enquiry-close" style="position: absolute; top: 16px; right: 16px; background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s;">&times;</button>
    
    <h2 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--text-main);">Make an Enquiry (Free)</h2>
    <p style="font-size: 0.9375rem; color: var(--text-muted); margin-bottom: 1.5rem;">Not ready to book yet? Tell us about your project and we'll help you choose the right service.</p>
    
    <form id="enquiry-form" style="display: flex; flex-direction: column; gap: 1.25rem;">
      <div>
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Name *</label>
        <input type="text" name="name" required style="width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border-soft); background: var(--bg-section); color: var(--text-main); font-size: 0.9375rem;" />
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Email *</label>
        <input type="email" name="email" required style="width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border-soft); background: var(--bg-section); color: var(--text-main); font-size: 0.9375rem;" />
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Project Description *</label>
        <textarea name="project" required rows="5" style="width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border-soft); background: var(--bg-section); color: var(--text-main); font-size: 0.9375rem; resize: vertical;" placeholder="Tell us about your project, what you're looking for, and any questions you have..."></textarea>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Budget (optional)</label>
        <input type="text" name="budget" style="width: 100%; padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border-soft); background: var(--bg-section); color: var(--text-main); font-size: 0.9375rem;" placeholder="e.g. £200-£500" />
      </div>
      
      <p style="font-size: 0.8125rem; color: var(--text-muted); opacity: 0.7; text-align: center; margin-top: 0.5rem;">This is a free enquiry. No payment required.</p>
      
      <button type="submit" id="enquiry-submit" style="width: 100%; padding: 14px; border-radius: 8px; background: var(--accent); color: white; font-weight: 600; font-size: 1rem; border: none; cursor: pointer; transition: all 0.2s;">
        Send Enquiry
      </button>
    </form>
    
    <div id="enquiry-success" style="display: none; text-align: center; padding: 40px 20px;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">✓</div>
      <h3 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.75rem; color: var(--text-main);">Enquiry Sent</h3>
      <p style="font-size: 1rem; color: var(--text-muted); margin-bottom: 1.5rem;">Thanks — we'll be in touch within 24 hours.</p>
      <button id="enquiry-success-close" style="padding: 12px 32px; border-radius: 8px; background: var(--accent); color: white; font-weight: 600; border: none; cursor: pointer;">Close</button>
    </div>
  </div>
</div>

<script>
  // Enquiry modal toggle
  const enquiryToggle = document.getElementById('enquiry-toggle');
  const enquiryModal = document.getElementById('enquiry-modal');
  const enquiryClose = document.getElementById('enquiry-close');
  const enquiryForm = document.getElementById('enquiry-form');
  const enquirySuccess = document.getElementById('enquiry-success');
  const enquirySuccessClose = document.getElementById('enquiry-success-close');
  const enquirySubmit = document.getElementById('enquiry-submit');
  
  // Add hover effect to enquiry button
  enquirySubmit.addEventListener('mouseenter', () => {
    enquirySubmit.style.opacity = '0.9';
  });
  enquirySubmit.addEventListener('mouseleave', () => {
    enquirySubmit.style.opacity = '1';
  });
  
  enquiryToggle.addEventListener('click', (e) => {
    e.preventDefault();
    enquiryModal.style.display = 'block';
    document.body.style.overflow = 'hidden';
  });
  
  enquiryClose.addEventListener('click', () => {
    enquiryModal.style.display = 'none';
    document.body.style.overflow = '';
    enquiryForm.style.display = 'flex';
    enquirySuccess.style.display = 'none';
    enquiryForm.reset();
  });
  
  enquirySuccessClose.addEventListener('click', () => {
    enquiryModal.style.display = 'none';
    document.body.style.overflow = '';
    enquiryForm.style.display = 'flex';
    enquirySuccess.style.display = 'none';
    enquiryForm.reset();
  });
  
  // Close modal on background click
  enquiryModal.addEventListener('click', (e) => {
    if (e.target === enquiryModal) {
      enquiryModal.style.display = 'none';
      document.body.style.overflow = '';
      enquiryForm.style.display = 'flex';
      enquirySuccess.style.display = 'none';
      enquiryForm.reset();
    }
  });
  
  // Handle enquiry form submission
  enquiryForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    enquirySubmit.disabled = true;
    enquirySubmit.textContent = 'Sending...';
    
    try {
      const formData = new FormData(enquiryForm);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        project: formData.get('project'),
        budget: formData.get('budget') || 'Not specified'
      };
      
      const response = await fetch('/.netlify/functions/submit-enquiry', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      
      if (response.ok) {
        enquiryForm.style.display = 'none';
        enquirySuccess.style.display = 'block';
      } else {
        throw new Error('Failed to send enquiry');
      }
    } catch (error) {
      console.error('Enquiry submission error:', error);
      alert('Sorry, there was an error sending your enquiry. Please email us directly at bookings@studioxv.co.uk');
      enquirySubmit.disabled = false;
      enquirySubmit.textContent = 'Send Enquiry';
    }
  });
</script>

</body>
</html>
