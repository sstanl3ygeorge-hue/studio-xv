<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Reader — Finishing Tracks Without Overthinking</title>
  <link rel="icon" type="image/png" href="/favicon.png">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <style>
    :root {
      --bg-main: #000000;
      --bg-section: #0d0d0d;
      --bg-card: #111111;
      --bg-soft: #181818;
      --text-main: #ffffff;
      --text-muted: #b5b5b5;
      --accent: #f97316;
      --border-soft: rgba(255,255,255,0.12);
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg-main: #ffffff;
        --bg-section: #f5f5f5;
        --bg-card: #ffffff;
        --bg-soft: #eeeeee;
        --text-main: #0b0b0b;
        --text-muted: #555555;
        --border-soft: rgba(0,0,0,0.12);
      }
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-main);
      color: var(--text-main);
      overflow: hidden;
      height: 100vh;
    }

    #pdf-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      height: calc(100vh - 140px);
      overflow: auto;
    }

    .page-wrapper {
      transition: opacity 0.3s ease;
    }

    .page-wrapper.flipping {
      opacity: 0.3;
    }

    #pdf-canvas {
      max-width: 100%;
      height: auto;
      box-shadow: 0 8px 40px rgba(0,0,0,0.4);
      border-radius: 4px;
    }

    .control-btn {
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .control-btn:hover {
      background: var(--bg-soft);
      border-color: var(--accent);
    }

    .control-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header class="border-b" style="background: var(--bg-main); border-color: var(--border-soft);">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
    <div>
      <h1 class="text-xl font-bold">Finishing Tracks Without Overthinking</h1>
      <p class="text-sm mt-1" style="color: var(--text-muted);">PDF Ebook · 18 pages</p>
    </div>
    <a href="course-finishing-tracks-info.html" 
       class="text-sm transition hover:text-[var(--accent)]"
       style="color: var(--text-muted);">
      ← Back to course
    </a>
  </div>
</header>

<!-- PDF VIEWER -->
<div id="pdf-container">
  <div class="page-wrapper">
    <canvas id="pdf-canvas"></canvas>
  </div>
</div>

<!-- CONTROLS -->
<footer class="border-t" style="background: var(--bg-main); border-color: var(--border-soft);">
  <div class="max-w-7xl mx-auto px-6 py-4">
    <div class="flex items-center justify-between flex-wrap gap-4">
      
      <!-- Navigation -->
      <div class="flex items-center gap-3">
        <button id="prev-page" class="control-btn">← Previous</button>
        <span class="text-sm" style="color: var(--text-muted);">
          Page <span id="current-page">1</span> of <span id="total-pages">--</span>
        </span>
        <button id="next-page" class="control-btn">Next →</button>
      </div>

      <!-- Zoom Controls -->
      <div class="flex items-center gap-3">
        <button id="zoom-out" class="control-btn">−</button>
        <span class="text-sm" style="color: var(--text-muted);">
          <span id="zoom-level">100</span>%
        </span>
        <button id="zoom-in" class="control-btn">+</button>
        <button id="fit-width" class="control-btn">Fit Width</button>
      </div>

      <!-- Progress -->
      <div class="text-sm" style="color: var(--text-muted);">
        <span id="progress">0</span>% complete
      </div>

    </div>
  </div>
</footer>

<script>
  // PDF.js Configuration
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  // State
  let pdfDoc = null;
  let currentPage = 1;
  let zoomLevel = 1;
  const canvas = document.getElementById('pdf-canvas');
  const ctx = canvas.getContext('2d');
  const pageWrapper = document.querySelector('.page-wrapper');

  // Load PDF
  const pdfUrl = 'ebooks/finishing-tracks-without-overthinking.pdf';

  console.log('Loading PDF from:', pdfUrl);

  pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
    console.log('PDF loaded successfully!', pdf.numPages, 'pages');
    pdfDoc = pdf;
    document.getElementById('total-pages').textContent = pdf.numPages;
    renderPage(currentPage);
  }).catch(err => {
    console.error('Error loading PDF:', err);
    document.getElementById('pdf-container').innerHTML = 
      '<div style="text-align: center; padding: 40px; color: var(--text-muted);">' +
      '<p>Unable to load PDF</p>' +
      '<p style="font-size: 12px; margin-top: 10px;">Check: ebooks/finishing-tracks-without-overthinking.pdf</p>' +
      '</div>';
  });

  // Render page
  function renderPage(num) {
    if (!pdfDoc) return;
    
    pdfDoc.getPage(num).then(page => {
      const container = document.getElementById('pdf-container');
      const containerWidth = container.clientWidth - 40;
      
      const viewport = page.getViewport({ scale: 1 });
      const baseScale = Math.min((containerWidth / viewport.width) * zoomLevel, 3);
      
      const scaledViewport = page.getViewport({ scale: baseScale });
      canvas.height = scaledViewport.height;
      canvas.width = scaledViewport.width;

      const renderContext = {
        canvasContext: ctx,
        viewport: scaledViewport
      };

      page.render(renderContext).promise.then(() => {
        updateUI();
      });
    });
  }

  // Update UI
  function updateUI() {
    document.getElementById('current-page').textContent = currentPage;
    document.getElementById('prev-page').disabled = currentPage === 1;
    document.getElementById('next-page').disabled = !pdfDoc || currentPage === pdfDoc.numPages;
    
    const progress = pdfDoc ? Math.round((currentPage / pdfDoc.numPages) * 100) : 0;
    document.getElementById('progress').textContent = progress;
    
    // Save progress
    localStorage.setItem('finishing-tracks-page', currentPage);
  }

  // Navigation with fade effect
  document.getElementById('prev-page').addEventListener('click', () => {
    if (currentPage > 1) {
      pageWrapper.classList.add('flipping');
      setTimeout(() => {
        currentPage--;
        renderPage(currentPage);
        pageWrapper.classList.remove('flipping');
      }, 150);
    }
  });

  document.getElementById('next-page').addEventListener('click', () => {
    if (pdfDoc && currentPage < pdfDoc.numPages) {
      pageWrapper.classList.add('flipping');
      setTimeout(() => {
        currentPage++;
        renderPage(currentPage);
        pageWrapper.classList.remove('flipping');
      }, 150);
    }
  });

  // Zoom controls
  document.getElementById('zoom-in').addEventListener('click', () => {
    zoomLevel += 0.25;
    document.getElementById('zoom-level').textContent = Math.round(zoomLevel * 100);
    renderPage(currentPage);
  });

  document.getElementById('zoom-out').addEventListener('click', () => {
    if (zoomLevel > 0.5) {
      zoomLevel -= 0.25;
      document.getElementById('zoom-level').textContent = Math.round(zoomLevel * 100);
      renderPage(currentPage);
    }
  });

  document.getElementById('fit-width').addEventListener('click', () => {
    zoomLevel = 1;
    document.getElementById('zoom-level').textContent = 100;
    renderPage(currentPage);
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft' && currentPage > 1) {
      pageWrapper.classList.add('flipping');
      setTimeout(() => {
        currentPage--;
        renderPage(currentPage);
        pageWrapper.classList.remove('flipping');
      }, 150);
    } else if (e.key === 'ArrowRight' && pdfDoc && currentPage < pdfDoc.numPages) {
      pageWrapper.classList.add('flipping');
      setTimeout(() => {
        currentPage++;
        renderPage(currentPage);
        pageWrapper.classList.remove('flipping');
      }, 150);
    }
  });

  // Restore last page on load
  window.addEventListener('load', () => {
    const savedPage = localStorage.getItem('finishing-tracks-page');
    if (savedPage && pdfDoc) {
      currentPage = parseInt(savedPage);
      renderPage(currentPage);
    }
  });
</script>

</body>
</html>
